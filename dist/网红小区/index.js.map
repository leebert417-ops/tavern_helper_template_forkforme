{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/src/ç½‘çº¢å°åŒº/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// ==================== ç½‘çº¢å°åŒº - å…¬å¯“ç®¡ç† ====================\n// ä½¿ç”¨ TypeScript + åŸç”Ÿå®ç°ï¼ˆå‚è€ƒæ±Ÿç•”å¤œæ€»ä¼šçš„æ¶æ„ï¼‰\n// ç‰ˆæœ¬ï¼šé‡æ„ç‰ˆ\n\nconsole.log('ğŸ  åŠ è½½ç½‘çº¢å°åŒºå…¬å¯“ç®¡ç†æ’ä»¶...');\n\n// ==================== ç±»å‹å®šä¹‰ ====================\ntype AnyObject = Record<string, any>;\n\n// ==================== æ ·å¼å®šä¹‰ ====================\n/* eslint-disable */\nconst styles = `\n<style id=\"ngq-plugin-styles\">\n:root {\n  --apt-primary: #ff6b9d;\n  --apt-secondary: #c44569;\n  --apt-bg: #1a1a2e;\n  --apt-card: #16213e;\n  --apt-border: rgba(255, 107, 157, 0.2);\n  --apt-text: #e8eaf6;\n  --apt-dim: #e5e7eb;\n}\n\n/* ==================== æ‹–åŠ¨æŒ‰é’® */\n.ngq-toggle-btn {\n  position: fixed !important;\n  top: 100px;\n  left: 20px;\n  width: 64px;\n  height: 64px;\n  background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: grab;\n  z-index: 10000 !important;\n  box-shadow: 0 6px 20px rgba(255, 107, 157, 0.4);\n  user-select: none;\n  -webkit-user-select: none;\n  touch-action: none;\n  font-size: 28px;\n  border: 3px solid rgba(255, 255, 255, 0.3);\n  color: #fff;\n  transition: transform 0.2s, box-shadow 0.2s, opacity 0.2s;\n}\n\n.ngq-toggle-btn:hover {\n  transform: scale(1.05);\n}\n\n.ngq-toggle-btn.dragging {\n  cursor: grabbing !important;\n  opacity: 0.9;\n  z-index: 10001 !important;\n  transition: none !important;\n}\n\n/* ==================== ä¸»é¢æ¿å®¹å™¨ */\n.ngq-main-panel {\n  position: fixed !important;\n  top: 50vh !important;\n  left: 50vw !important;\n  transform: translate(-50%, -50%) !important;\n  width: 90vw !important;\n  max-width: 900px !important;\n  height: 85vh !important;\n  max-height: 650px !important;\n  background: var(--apt-bg);\n  background: linear-gradient(135deg, var(--apt-bg) 0%, #16213e 100%);\n  border: 2px solid var(--apt-primary);\n  border-radius: 16px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);\n  z-index: 9999 !important;\n  display: none;\n  flex-direction: column;\n  overflow: hidden;\n  color: var(--apt-text);\n  font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;\n}\n\n.ngq-main-panel.active {\n  display: flex;\n}\n\n.ngq-main-panel.dragging {\n  transition: none !important;\n}\n\n/* ==================== å¤´éƒ¨ */\n.ngq-header {\n  flex-shrink: 0;\n  padding: 16px 20px;\n  background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);\n  color: white;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  font-weight: 600;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);\n  cursor: move;\n  user-select: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  transition: opacity 0.2s;\n  touch-action: none !important;\n}\n\n.ngq-header.dragging {\n  opacity: 0.8;\n  cursor: grabbing !important;\n  transition: none !important;\n}\n\n.ngq-header-left {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n\n.ngq-header-title {\n  font-size: 18px;\n  font-weight: 700;\n}\n\n.ngq-header-subtitle {\n  font-size: 12px;\n  opacity: 0.9;\n}\n\n.ngq-close-btn {\n  background: transparent;\n  border: none;\n  color: white;\n  font-size: 32px;\n  cursor: pointer;\n  line-height: 1;\n  padding: 0;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: transform 0.2s;\n}\n\n.ngq-close-btn:hover {\n  transform: scale(1.1);\n}\n\n/* ==================== æ ‡ç­¾é¡µå¯¼èˆª */\n.ngq-tabs {\n  display: flex;\n  flex-shrink: 0;\n  border-bottom: 2px solid rgba(255, 255, 255, 0.1);\n}\n\n.ngq-tab {\n  flex: 1;\n  padding: 12px 16px;\n  background: transparent;\n  border: none;\n  color: rgba(255, 255, 255, 0.6);\n  font-size: 14px;\n  cursor: pointer;\n  transition: all 0.3s;\n  border-bottom: 2px solid transparent;\n  text-align: center;\n}\n\n.ngq-tab:hover {\n  background: rgba(255, 255, 255, 0.05);\n  color: rgba(255, 255, 255, 0.9);\n}\n\n.ngq-tab.active {\n  color: var(--apt-primary);\n  border-bottom-color: var(--apt-primary);\n}\n\n.ngq-tab-badge {\n  display: inline-block;\n  margin-left: 6px;\n  padding: 2px 6px;\n  background: var(--apt-primary);\n  border-radius: 10px;\n  font-size: 11px;\n  font-weight: 700;\n  color: #fff;\n}\n\n/* ==================== å†…å®¹åŒºåŸŸ */\n.ngq-content {\n  flex: 1;\n  padding: 20px;\n  overflow-y: auto;\n  -webkit-overflow-scrolling: touch;\n}\n\n.ngq-content::-webkit-scrollbar {\n  width: 8px;\n}\n\n.ngq-content::-webkit-scrollbar-track {\n  background: rgba(255, 255, 255, 0.05);\n}\n\n.ngq-content::-webkit-scrollbar-thumb {\n  background: var(--apt-primary);\n  border-radius: 4px;\n}\n\n/* ==================== å¡ç‰‡æ ·å¼ */\n.ngq-card {\n  background: var(--apt-card);\n  border: 1px solid var(--apt-border);\n  border-radius: 10px;\n  margin-bottom: 16px;\n  overflow: hidden;\n}\n\n.ngq-card-title {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px 16px;\n  background: rgba(255, 107, 157, 0.15);\n  font-weight: 600;\n  font-size: 16px;\n}\n\n.ngq-card-body {\n  padding: 16px;\n}\n\n.ngq-info-row {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 8px 0;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.ngq-info-row:last-child {\n  border-bottom: none;\n}\n\n.ngq-info-label {\n  color: var(--apt-dim);\n  font-size: 14px;\n}\n\n.ngq-info-value {\n  color: var(--apt-text);\n  font-weight: 500;\n  text-align: right;\n}\n\n/* ==================== æ¥¼å±‚æ ·å¼ */\n.ngq-floor-level {\n  background: var(--apt-card);\n  border: 1px solid var(--apt-border);\n  border-radius: 12px;\n  padding: 16px;\n  margin-bottom: 16px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);\n}\n\n.ngq-floor-level-title {\n  font-size: 1.1em;\n  font-weight: 600;\n  margin-bottom: 12px;\n  color: var(--apt-text);\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.ngq-floor-grid {\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  gap: 12px;\n  width: 100%;\n}\n\n.ngq-room-card {\n  border-radius: 10px;\n  padding: 18px 12px;\n  min-height: 90px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  text-align: center;\n  font-weight: 600;\n  font-size: 0.9em;\n  border: 2px solid rgba(255, 255, 255, 0.3);\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.ngq-room-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(255, 107, 157, 0.3);\n  border-color: var(--apt-primary);\n}\n\n.ngq-room-card.bedroom {\n  background: linear-gradient(135deg, #592e39 0%, #7a4053 100%);\n}\n\n.ngq-room-card.bedroom.vacant {\n  background: linear-gradient(135deg, rgba(255, 182, 193, 0.6) 0%, rgba(255, 192, 203, 0.7) 100%);\n  border-color: rgba(255, 182, 193, 0.8);\n  backdrop-filter: blur(2px);\n}\n\n.ngq-room-card.empty {\n  background: linear-gradient(135deg, #3d3f47 0%, #4a4f5a 100%);\n  border-color: #5a5f6b;\n  opacity: 0.7;\n}\n\n.ngq-room-card.your {\n  background: linear-gradient(135deg, #2e5266 0%, #3a6d8c 100%);\n  border-color: #5dade2;\n}\n\n/* å…¬å…±å®¢å… - æ¸©é¦¨æ©™è‰² */\n.ngq-room-card.public-lounge {\n  background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);\n  border-color: #fbbf24;\n}\n\n/* å¥èº«æˆ¿ - æ´»åŠ›ç»¿è‰² */\n.ngq-room-card.public-gym {\n  background: linear-gradient(135deg, #059669 0%, #10b981 100%);\n  border-color: #34d399;\n}\n\n/* æ´—è¡£é—´ - æ¸…æ–°è“è‰² */\n.ngq-room-card.public-laundry {\n  background: linear-gradient(135deg, #0284c7 0%, #0ea5e9 100%);\n  border-color: #38bdf8;\n}\n\n/* ç”¨æˆ·è‡ªå®šä¹‰åŠŸèƒ½æ€§æˆ¿é—´ - åŠé€æ˜ç»¿è‰² */\n.ngq-room-card.custom-functional {\n  background: linear-gradient(135deg, rgba(16, 185, 129, 0.6) 0%, rgba(52, 211, 153, 0.7) 100%);\n  border-color: rgba(52, 211, 153, 0.8);\n  opacity: 0.95;\n}\n\n/* åˆå¹¶æˆ¿é—´ - å æ®åŒå€å®½åº¦ */\n.ngq-room-card.merged {\n  grid-column: span 2;\n}\n\n.ngq-room-name {\n  font-weight: bold;\n  font-size: 0.95em;\n}\n\n.ngq-room-occupant {\n  font-size: 0.75em;\n  color: var(--apt-dim);\n  margin-top: 4px;\n}\n\n/* ==================== ç§Ÿå®¢å¡ç‰‡ */\n.ngq-tenant-card {\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid var(--apt-border);\n  border-radius: 8px;\n  padding: 12px;\n  margin-bottom: 12px;\n  transition: all 0.3s;\n  cursor: pointer;\n}\n\n.ngq-tenant-card:hover {\n  border-color: var(--apt-primary);\n  background: rgba(255, 107, 157, 0.1);\n  transform: translateX(4px);\n}\n\n.ngq-tenant-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n\n.ngq-tenant-name {\n  font-weight: 600;\n  font-size: 15px;\n  color: var(--apt-primary);\n}\n\n.ngq-tenant-badge {\n  font-size: 12px;\n  padding: 2px 8px;\n  background: rgba(255, 255, 255, 0.2);\n  border-radius: 4px;\n}\n\n/* ==================== æŒ‰é’® */\n.ngq-btn {\n  padding: 10px 16px;\n  background: var(--apt-primary);\n  color: #fff;\n  border: none;\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: 600;\n  transition: all 0.3s;\n}\n\n.ngq-btn:hover:not(:disabled) {\n  background: var(--apt-secondary);\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(255, 107, 157, 0.3);\n}\n\n.ngq-btn:disabled {\n  background: #555;\n  cursor: not-allowed;\n  opacity: 0.4;\n}\n\n.ngq-actions {\n  display: flex;\n  gap: 10px;\n  margin-top: 12px;\n}\n\n.ngq-management-actions {\n  display: flex;\n  flex-direction: row;\n  gap: 12px;\n  margin-top: 12px;\n}\n\n.ngq-management-actions .ngq-btn {\n  flex: 1;\n  padding: 14px 20px;\n  min-width: 0;\n}\n\n@media (max-width: 768px) and (orientation: portrait) {\n  .ngq-management-actions {\n    flex-direction: column;\n  }\n  \n  .ngq-management-actions .ngq-btn {\n    width: 100%;\n  }\n}\n\n.ngq-tenant-actions {\n  margin-bottom: 16px;\n  text-align: center;\n}\n\n/* ==================== ç©ºçŠ¶æ€ */\n.ngq-empty {\n  text-align: center;\n  padding: 40px 20px;\n  color: var(--apt-dim);\n}\n\n.ngq-empty-icon {\n  font-size: 48px;\n  margin-bottom: 12px;\n  opacity: 0.5;\n}\n\n.ngq-empty-text {\n  font-size: 14px;\n}\n\n/* ==================== æ¨¡æ€æ¡† */\n.ngq-modal-overlay {\n  position: fixed !important;\n  top: 0 !important;\n  left: 0 !important;\n  width: 100vw !important;\n  height: 100vh !important;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(4px);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 10500 !important;\n  opacity: 1;\n  transition: opacity 0.3s;\n}\n\n.ngq-modal-overlay.hidden {\n  display: none;\n  opacity: 0;\n}\n\n.ngq-modal-content {\n  background: var(--apt-card);\n  color: var(--apt-text);\n  padding: 28px;\n  border-radius: 20px;\n  width: 90%;\n  max-width: 420px;\n  max-height: 80vh;\n  overflow-y: auto;\n  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n  border: 2px solid var(--apt-border);\n}\n\n.ngq-modal-title {\n  margin: 0;\n  font-size: 1.4em;\n  font-weight: 700;\n  color: var(--apt-primary);\n}\n\n.ngq-modal-subtitle {\n  color: var(--apt-dim);\n  margin: 0;\n  font-size: 0.95em;\n  line-height: 1.5;\n}\n\n.ngq-modal-input {\n  width: 100%;\n  padding: 12px 16px;\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid var(--apt-border);\n  border-radius: 8px;\n  color: var(--apt-text);\n  font-size: 14px;\n  outline: none;\n  transition: border-color 0.3s;\n}\n\n.ngq-modal-input:focus {\n  border-color: var(--apt-primary);\n}\n\n.ngq-modal-input::placeholder {\n  color: var(--apt-dim);\n}\n\n.ngq-modal-actions {\n  display: flex;\n  gap: 12px;\n}\n\n.ngq-modal-btn {\n  flex: 1;\n  padding: 12px 16px;\n  border: none;\n  border-radius: 8px;\n  font-size: 14px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s;\n}\n\n.ngq-modal-btn-confirm {\n  background: var(--apt-primary);\n  color: #fff;\n}\n\n.ngq-modal-btn-confirm:hover {\n  background: var(--apt-secondary);\n  transform: translateY(-1px);\n}\n\n.ngq-modal-btn-cancel {\n  background: rgba(255, 255, 255, 0.1);\n  color: var(--apt-text);\n}\n\n.ngq-modal-btn-cancel:hover {\n  background: rgba(255, 255, 255, 0.15);\n}\n\n/* ==================== åŠ è½½çŠ¶æ€ */\n.ngq-loading {\n  text-align: center;\n  padding: 40px;\n  color: var(--apt-dim);\n}\n\n.ngq-loading-icon {\n  font-size: 32px;\n  margin-bottom: 12px;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n/* ==================== è¿›åº¦æ¡ */\n.ngq-progress-bar {\n  width: 100%;\n  height: 20px;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 10px;\n  overflow: hidden;\n  position: relative;\n  margin-top: 6px;\n}\n\n.ngq-progress-fill {\n  height: 100%;\n  border-radius: 10px;\n  transition: width 0.3s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 12px;\n  font-weight: 600;\n  color: white;\n  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);\n}\n\n.ngq-progress-fill.favor {\n  background: linear-gradient(90deg, #ff6b9d 0%, #ff8fab 100%);\n}\n\n.ngq-progress-fill.lust {\n  background: linear-gradient(90deg, #ff4757 0%, #ff6348 100%);\n}\n\n.ngq-info-block {\n  display: block;\n  padding: 8px 0;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.ngq-info-block:last-child {\n  border-bottom: none;\n}\n\n.ngq-info-block .ngq-info-label {\n  display: block;\n  margin-bottom: 6px;\n}\n\n.ngq-info-block .ngq-info-value {\n  display: block;\n  text-align: left;\n  line-height: 1.5;\n}\n\n/* ==================== ç§»åŠ¨ç«¯é€‚é… */\n@media (max-width: 768px) {\n  .ngq-main-panel {\n    width: 95vw;\n    height: 90vh;\n  }\n\n  .ngq-toggle-btn {\n    width: 56px;\n    height: 56px;\n    font-size: 24px;\n  }\n\n  .ngq-tab {\n    font-size: 12px;\n    padding: 10px 8px;\n  }\n\n  .ngq-toggle-btn {\n    pointer-events: auto;\n    z-index: 10002;\n  }\n}\n\n@media (max-width: 480px) and (orientation: portrait) {\n  .ngq-main-panel {\n    width: 100vw;\n    height: 100vh;\n    max-width: none;\n    max-height: none;\n    border-radius: 0;\n    border: none;\n  }\n\n  .ngq-toggle-btn {\n    width: 50px;\n    height: 50px;\n    font-size: 22px;\n  }\n\n  .ngq-tab {\n    font-size: 11px;\n    padding: 8px 4px;\n  }\n\n  .ngq-toggle-btn {\n    z-index: 10002;\n  }\n}\n\n@media (max-height: 600px) and (orientation: landscape) {\n  .ngq-main-panel {\n    height: 95vh;\n    max-height: none;\n  }\n\n  .ngq-content {\n    padding: 10px;\n  }\n}\n\n/* ==================== å…¨å±€ç§»åŠ¨ç«¯ä¼˜åŒ– */\n* {\n  touch-action: manipulation;\n}\n\n.ngq-toggle-btn {\n  touch-action: none !important;\n}\n\n* {\n  -webkit-tap-highlight-color: transparent;\n  -webkit-touch-callout: none;\n}\n\n.ngq-content {\n  -webkit-overflow-scrolling: touch;\n}\n\nbody {\n  -webkit-text-size-adjust: 100%;\n  -ms-text-size-adjust: 100%;\n  text-size-adjust: 100%;\n}\n\n@supports (padding: max(0px)) {\n  @media (max-width: 480px) {\n    .ngq-main-panel {\n      padding-top: max(0px, env(safe-area-inset-top));\n      padding-bottom: max(0px, env(safe-area-inset-bottom));\n      padding-left: max(0px, env(safe-area-inset-left));\n      padding-right: max(0px, env(safe-area-inset-right));\n    }\n  }\n}\n\nbutton:focus,\nbutton:active,\n.ngq-toggle-btn:focus,\n.ngq-toggle-btn:active,\n.ngq-close-btn:focus,\n.ngq-close-btn:active,\n.ngq-tenant-card:focus,\n.ngq-tenant-card:active {\n  outline: none;\n  outline-color: transparent;\n}\n</style>\n`;\n/* eslint-enable */\n\n// ==================== HTML ç»“æ„ ====================\nconst html = `\n<!-- æ‹–åŠ¨æŒ‰é’® -->\n<div id=\"ngq-toggle-btn\" class=\"ngq-toggle-btn\">\n  <span>ğŸ </span>\n</div>\n\n<!-- ä¸»é¢æ¿ -->\n<div id=\"ngq-main-panel\" class=\"ngq-main-panel\">\n  <div class=\"ngq-header\">\n    <div class=\"ngq-header-left\">\n      <div class=\"ngq-header-title\">ğŸ  ç½‘çº¢å°åŒº</div>\n      <div class=\"ngq-header-subtitle\" id=\"ngq-time-display\">ä¸œæµ·å¸‚Â·èŸèƒåŸ</div>\n    </div>\n    <button class=\"ngq-close-btn\" id=\"ngq-close-btn\">Ã—</button>\n  </div>\n  \n  <div class=\"ngq-content\" id=\"ngq-content\">\n    <div class=\"ngq-loading\">\n      <div class=\"ngq-loading-icon\">â³</div>\n      <div>æ­£åœ¨åŠ è½½æ•°æ®...</div>\n    </div>\n  </div>\n</div>\n\n<!-- æ‹›å‹Ÿç§Ÿå®¢æ¨¡æ€æ¡† -->\n<div id=\"ngq-recruitment-modal\" class=\"ngq-modal-overlay hidden\">\n  <div class=\"ngq-modal-content\">\n    <h2 class=\"ngq-modal-title\">ğŸ‘¤ æ‹›å‹Ÿæ–°ç§Ÿå®¢</h2>\n    <p class=\"ngq-modal-subtitle\">ç½‘çº¢å°åŒºä¸“æ³¨äºå†…å®¹åˆ›ä½œè€…ï¼Œè¯·è¾“å…¥æ‚¨æœŸæœ›çš„ç§Ÿå®¢ç‰¹å¾</p>\n    <input type=\"text\" id=\"ngq-recruitment-keywords\" class=\"ngq-modal-input\" placeholder=\"ä¾‹å¦‚ï¼šç¾å¦†åšä¸»ã€æ¸¸æˆä¸»æ’­ã€èˆè¹ˆUPä¸»\">\n    <div class=\"ngq-modal-actions\">\n      <button class=\"ngq-modal-btn ngq-modal-btn-cancel\" id=\"ngq-modal-cancel\">å–æ¶ˆ</button>\n      <button class=\"ngq-modal-btn ngq-modal-btn-confirm\" id=\"ngq-modal-confirm\">ç¡®è®¤æ‹›å‹Ÿ</button>\n    </div>\n  </div>\n</div>\n\n<!-- æˆ¿é—´è¯¦æƒ…æ¨¡æ€æ¡† -->\n<div id=\"ngq-room-modal\" class=\"ngq-modal-overlay hidden\">\n  <div class=\"ngq-modal-content\" style=\"max-width: 500px\">\n    <h2 class=\"ngq-modal-title\" id=\"ngq-room-modal-title\">ğŸ  æˆ¿é—´è¯¦æƒ…</h2>\n    <div id=\"ngq-room-modal-body\"></div>\n    <div class=\"ngq-modal-actions\" id=\"ngq-room-modal-actions\">\n      <button class=\"ngq-modal-btn ngq-modal-btn-confirm\" id=\"ngq-room-modal-close\" style=\"width:100%\">å…³é—­</button>\n    </div>\n    <div class=\"ngq-modal-actions\" id=\"ngq-room-demolish-actions\" style=\"display:none; margin-top: 8px;\">\n      <button class=\"ngq-modal-btn\" id=\"ngq-room-demolish\" style=\"width:100%; background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);\">\n        ğŸ—‘ï¸ æ‹†é™¤æˆ¿é—´\n      </button>\n    </div>\n  </div>\n</div>\n\n<!-- è£…ä¿®é€‰æ‹©æ¨¡æ€æ¡† -->\n<div id=\"ngq-renovate-modal\" class=\"ngq-modal-overlay hidden\">\n  <div class=\"ngq-modal-content\" style=\"max-width: 450px\">\n    <h2 class=\"ngq-modal-title\">ğŸ”¨ è£…ä¿®é€‰æ‹©</h2>\n    <p class=\"ngq-modal-subtitle\" id=\"ngq-renovate-room-info\">é€‰æ‹©è¦å°†æ­¤ç©ºæˆ¿é—´è£…ä¿®ä¸ºä½•ç§ç±»å‹ï¼š</p>\n    <div style=\"display: flex; flex-direction: column; gap: 12px; margin-top: 16px;\">\n      <button class=\"ngq-modal-btn ngq-modal-btn-confirm\" id=\"ngq-renovate-suite\" style=\"padding: 16px; font-size: 15px;\">\n        ğŸ  æ ‡å‡†å¥—é—´\n        <div style=\"font-size: 12px; opacity: 0.8; margin-top: 4px;\">ä¸€å®¤ä¸€å…ä¸€å«ä¸€å¨ï¼Œå¯å‡ºç§Ÿç»™ç§Ÿå®¢</div>\n      </button>\n      <button class=\"ngq-modal-btn ngq-modal-btn-confirm\" id=\"ngq-renovate-functional\" style=\"padding: 16px; font-size: 15px; background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);\">\n        ğŸ”§ åŠŸèƒ½æ€§æˆ¿é—´\n        <div style=\"font-size: 12px; opacity: 0.8; margin-top: 4px;\">å…¬å…±è®¾æ–½ï¼ˆå®¢å…/å¥èº«æˆ¿/æ´—è¡£é—´ç­‰ï¼‰</div>\n      </button>\n    </div>\n    <div class=\"ngq-modal-actions\" style=\"margin-top: 16px;\">\n      <button class=\"ngq-modal-btn ngq-modal-btn-cancel\" id=\"ngq-renovate-cancel\" style=\"width:100%\">å–æ¶ˆ</button>\n    </div>\n  </div>\n</div>\n\n<!-- åŠŸèƒ½æ€§æˆ¿é—´è¯¦æƒ…è¾“å…¥æ¨¡æ€æ¡† -->\n<div id=\"ngq-functional-input-modal\" class=\"ngq-modal-overlay hidden\">\n  <div class=\"ngq-modal-content\" style=\"max-width: 450px\">\n    <h2 class=\"ngq-modal-title\">ğŸ”§ åŠŸèƒ½æ€§æˆ¿é—´è¯¦æƒ…</h2>\n    <p class=\"ngq-modal-subtitle\" id=\"ngq-functional-room-info\">è¯·è¾“å…¥åŠŸèƒ½æ€§æˆ¿é—´çš„è¯¦ç»†ä¿¡æ¯ï¼š</p>\n    <div style=\"display: flex; flex-direction: column; gap: 12px; margin-top: 16px;\">\n      <div>\n        <label style=\"display: block; margin-bottom: 6px; color: var(--apt-dim); font-size: 14px;\">æˆ¿é—´åç§°</label>\n        <input type=\"text\" id=\"ngq-functional-name\" class=\"ngq-modal-input\" placeholder=\"ä¾‹å¦‚ï¼šå¥èº«æˆ¿ã€å½±éŸ³å®¤ã€èŒ¶å®¤\">\n      </div>\n      <div>\n        <label style=\"display: block; margin-bottom: 6px; color: var(--apt-dim); font-size: 14px;\">æˆ¿é—´ä½œç”¨</label>\n        <input type=\"text\" id=\"ngq-functional-purpose\" class=\"ngq-modal-input\" placeholder=\"ä¾‹å¦‚ï¼šé…å¤‡è·‘æ­¥æœºå’Œç‘œä¼½å«ï¼Œä¾›ç§Ÿå®¢å…è´¹ä½¿ç”¨\">\n      </div>\n    </div>\n    <div class=\"ngq-modal-actions\" style=\"margin-top: 16px;\">\n      <button class=\"ngq-modal-btn ngq-modal-btn-cancel\" id=\"ngq-functional-cancel\">å–æ¶ˆ</button>\n      <button class=\"ngq-modal-btn ngq-modal-btn-confirm\" id=\"ngq-functional-confirm\">ç¡®è®¤è£…ä¿®</button>\n    </div>\n  </div>\n</div>\n`;\n\n// ==================== å…¨å±€å˜é‡ ====================\nlet btnDragData: {\n  startX: number;\n  startY: number;\n  initialLeft: number;\n  initialTop: number;\n} | null = null;\nlet panelDragData: {\n  startX: number;\n  startY: number;\n  initialLeft: number;\n  initialTop: number;\n} | null = null;\nlet cachedMVUData: any = null;\nconst MAX_RETRIES = 5;\nconst RETRY_DELAY = 400;\nlet currentRetry = 0;\nlet autoRefreshTimer: number | null = null;\nlet contentEventsInitialized = false; // æ ‡è®°å†…å®¹åŒºäº‹ä»¶æ˜¯å¦å·²ç»‘å®š\nlet currentRenovatingRoom = ''; // å½“å‰æ­£åœ¨è£…ä¿®çš„æˆ¿é—´å·\nlet currentRoomForDemolish = ''; // å½“å‰å¾…æ‹†é™¤çš„æˆ¿é—´å·\n\n// ==================== å·¥å…·å‡½æ•° ====================\nfunction safeGetValue(obj: AnyObject | undefined, path: string, defaultValue: string = ''): string {\n  if (!obj) return defaultValue;\n  const keys = path.split('.');\n  let current: any = obj;\n  for (const key of keys) {\n    if (current === undefined || current === null) return defaultValue;\n    // å…ˆè§£åŒ… MVU æ•°ç»„æ ¼å¼\n    if (Array.isArray(current)) {\n      current = current[0];\n    }\n    if (typeof current !== 'object' || !Object.prototype.hasOwnProperty.call(current, key)) {\n      return defaultValue;\n    }\n    current = current[key];\n  }\n  // æœ€åè§£åŒ… MVU æ•°ç»„æ ¼å¼\n  if (Array.isArray(current)) return current.length > 0 ? String(current[0] ?? defaultValue) : defaultValue;\n  if (current === undefined || current === null) return defaultValue;\n  return String(current);\n}\n\n// ==================== åˆå§‹åŒ–å‡½æ•° ====================\nfunction initializeNgqPlugin(): void {\n  console.log('ğŸš€ åˆå§‹åŒ–ç½‘çº¢å°åŒºæ’ä»¶...');\n\n  // è·å–ç›®æ ‡æ–‡æ¡£\n  let targetDoc: Document;\n  try {\n    targetDoc = window.top ? window.top.document : document;\n  } catch (e) {\n    console.warn('âš ï¸ æ— æ³•è®¿é—® window.topï¼Œä½¿ç”¨å½“å‰ document');\n    targetDoc = document;\n  }\n\n  // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨\n  if (targetDoc.getElementById('ngq-toggle-btn')) {\n    console.log('âš ï¸ ç½‘çº¢å°åŒºæ’ä»¶å·²å­˜åœ¨ï¼Œå…ˆç§»é™¤æ—§çš„');\n    targetDoc.getElementById('ngq-toggle-btn')?.remove();\n    targetDoc.getElementById('ngq-main-panel')?.remove();\n    targetDoc.getElementById('ngq-plugin-styles')?.remove();\n    targetDoc.getElementById('ngq-recruitment-modal')?.remove();\n    targetDoc.getElementById('ngq-room-modal')?.remove();\n    targetDoc.getElementById('ngq-renovate-modal')?.remove();\n    targetDoc.getElementById('ngq-functional-input-modal')?.remove();\n    // æ¸…ç†äº‹ä»¶\n    $(targetDoc).off('.ngq-plugin');\n    // é‡ç½®äº‹ä»¶ç»‘å®šæ ‡å¿—\n    contentEventsInitialized = false;\n  }\n\n  // æ³¨å…¥æ ·å¼\n  if (!targetDoc.getElementById('ngq-plugin-styles')) {\n    targetDoc.head.insertAdjacentHTML('beforeend', styles);\n    console.log('âœ… æ ·å¼å·²æ³¨å…¥');\n  }\n\n  // æ³¨å…¥ HTML\n  targetDoc.body.insertAdjacentHTML('beforeend', html);\n  console.log('âœ… HTML å·²æ³¨å…¥');\n\n  // ä» localStorage æ¢å¤æŒ‰é’®ä½ç½®\n  const btn = targetDoc.getElementById('ngq-toggle-btn');\n  if (btn) {\n    try {\n      const saved = localStorage.getItem('ngq-btn-position');\n      if (saved) {\n        const pos = JSON.parse(saved);\n        // éªŒè¯ä½ç½®æ˜¯å¦åœ¨å±å¹•å†…\n        const targetWindow = window.top || window;\n        const maxX = $(targetWindow).width()! - 80;\n        const maxY = $(targetWindow).height()! - 80;\n\n        // ç¡®ä¿ä½ç½®æœ‰æ•ˆ\n        if (pos.left >= 0 && pos.left <= maxX && pos.top >= 0 && pos.top <= maxY) {\n          btn.style.left = pos.left + 'px';\n          btn.style.top = pos.top + 'px';\n          console.log('ğŸ“ æ¢å¤æŒ‰é’®ä½ç½®:', pos);\n        } else {\n          console.log('âš ï¸ ä¿å­˜çš„ä½ç½®æ— æ•ˆï¼Œä½¿ç”¨é»˜è®¤ä½ç½®');\n        }\n      }\n    } catch (e) {\n      console.warn('âš ï¸ æ¢å¤æŒ‰é’®ä½ç½®å¤±è´¥');\n    }\n  }\n\n  // åˆå§‹åŒ–æŒ‰é’®æ‹–åŠ¨åŠŸèƒ½\n  initializeButtonDrag(targetDoc);\n\n  // åˆå§‹åŒ–é¢æ¿åŠŸèƒ½\n  initializePanelSystem(targetDoc);\n\n  // åˆå§‹åŒ–æ¨¡æ€æ¡†äº‹ä»¶\n  initializeModalEvents(targetDoc);\n\n  console.log('âœ… ç½‘çº¢å°åŒºæ’ä»¶åˆå§‹åŒ–å®Œæˆï¼');\n}\n\n// ==================== æŒ‰é’®æ‹–åŠ¨åŠŸèƒ½ ====================\nfunction initializeButtonDrag(targetDoc: Document): void {\n  const btn = targetDoc.getElementById('ngq-toggle-btn');\n  const panel = targetDoc.getElementById('ngq-main-panel');\n  const $targetDoc = $(targetDoc);\n\n  // æ‹–åŠ¨å¼€å§‹\n  function handleBtnDragStart(clientX: number, clientY: number): boolean {\n    if (btnDragData) return false;\n\n    const computedStyle = window.getComputedStyle(btn!);\n    const currentLeft = parseInt(computedStyle.left) || 0;\n    const currentTop = parseInt(computedStyle.top) || 0;\n\n    btnDragData = {\n      startX: clientX,\n      startY: clientY,\n      initialLeft: currentLeft,\n      initialTop: currentTop,\n    };\n\n    btn!.classList.add('dragging');\n    console.log('ğŸ–±ï¸ å¼€å§‹æ‹–åŠ¨æŒ‰é’®');\n    return true;\n  }\n\n  // æ‹–åŠ¨ç§»åŠ¨\n  function handleBtnDragMove(clientX: number, clientY: number): void {\n    if (!btnDragData) return;\n\n    const deltaX = clientX - btnDragData.startX;\n    const deltaY = clientY - btnDragData.startY;\n\n    let newLeft = btnDragData.initialLeft + deltaX;\n    let newTop = btnDragData.initialTop + deltaY;\n\n    // é™åˆ¶èŒƒå›´\n    const targetWindow = window.top || window;\n    const maxX = $(targetWindow).width()! - 80;\n    const maxY = $(targetWindow).height()! - 80;\n\n    newLeft = Math.max(0, Math.min(newLeft, maxX));\n    newTop = Math.max(0, Math.min(newTop, maxY));\n\n    btn!.style.left = newLeft + 'px';\n    btn!.style.top = newTop + 'px';\n  }\n\n  // æ‹–åŠ¨ç»“æŸ\n  function handleBtnDragEnd(clientX: number, clientY: number): void {\n    if (!btnDragData) return;\n\n    btn!.classList.remove('dragging');\n\n    // è®¡ç®—æ‹–åŠ¨è·ç¦»\n    const deltaX = clientX - btnDragData.startX;\n    const deltaY = clientY - btnDragData.startY;\n    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n\n    // ä¿å­˜ä½ç½®\n    const computedStyle = window.getComputedStyle(btn!);\n    const currentLeft = parseInt(computedStyle.left) || 0;\n    const currentTop = parseInt(computedStyle.top) || 0;\n\n    const position = {\n      left: currentLeft,\n      top: currentTop,\n    };\n\n    localStorage.setItem('ngq-btn-position', JSON.stringify(position));\n    console.log('âœ… æŒ‰é’®æ‹–åŠ¨ç»“æŸï¼Œä¿å­˜ä½ç½®:', position);\n\n    btnDragData = null;\n\n    // å¦‚æœæ˜¯ç‚¹å‡»ï¼ˆç§»åŠ¨è·ç¦»å°äº5åƒç´ ï¼‰ï¼Œæ‰“å¼€/å…³é—­é¢æ¿\n    if (distance < 5) {\n      console.log('ğŸ¨ æ£€æµ‹åˆ°ç‚¹å‡»ï¼Œåˆ‡æ¢é¢æ¿');\n      panel!.classList.toggle('active');\n      // æ‰“å¼€é¢æ¿æ—¶åŠ è½½æ•°æ®\n      if (panel!.classList.contains('active')) {\n        currentRetry = 0;\n        loadNgqData(targetDoc);\n      }\n    }\n  }\n\n  // ç»‘å®šäº‹ä»¶\n  $(btn!).on('mousedown.ngq-plugin', function (e) {\n    if (handleBtnDragStart(e.clientX, e.clientY)) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  });\n\n  $(btn!).on('touchstart.ngq-plugin', function (e) {\n    const touch = e.originalEvent!.touches[0];\n    if (handleBtnDragStart(touch.clientX, touch.clientY)) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  });\n\n  $targetDoc.on('mousemove.ngq-plugin', function (e) {\n    handleBtnDragMove(e.clientX, e.clientY);\n    if (btnDragData) e.preventDefault();\n  });\n\n  $targetDoc.on('touchmove.ngq-plugin', function (e) {\n    const touch = e.originalEvent!.touches[0];\n    handleBtnDragMove(touch.clientX, touch.clientY);\n    if (btnDragData) e.preventDefault();\n  });\n\n  $targetDoc.on('mouseup.ngq-plugin', function (e) {\n    handleBtnDragEnd(e.clientX, e.clientY);\n  });\n\n  $targetDoc.on('touchend.ngq-plugin touchcancel.ngq-plugin', function (e) {\n    const touch = e.originalEvent!.changedTouches[0];\n    if (touch) {\n      handleBtnDragEnd(touch.clientX, touch.clientY);\n    } else {\n      handleBtnDragEnd(0, 0);\n    }\n  });\n\n  console.log('âœ… æŒ‰é’®æ‹–åŠ¨åŠŸèƒ½å·²åˆå§‹åŒ–');\n}\n\n// ==================== é¢æ¿æ‹–åŠ¨ ====================\nfunction initializePanelDrag(targetDoc: Document): void {\n  const panel = $('#ngq-main-panel', targetDoc)[0];\n  const header = $('.ngq-header', targetDoc)[0];\n  const $targetDoc = $(targetDoc);\n\n  if (!panel || !header) {\n    console.error('âŒ é¢æ¿æˆ–å¤´éƒ¨å…ƒç´ æœªæ‰¾åˆ°');\n    return;\n  }\n\n  function handlePanelDragStart(clientX: number, clientY: number): void {\n    console.log('ğŸ–±ï¸ å¼€å§‹æ‹–åŠ¨é¢æ¿');\n    const rect = panel!.getBoundingClientRect();\n\n    panel!.style.setProperty('transform', 'none', 'important');\n    panel!.style.setProperty('left', `${rect.left}px`, 'important');\n    panel!.style.setProperty('top', `${rect.top}px`, 'important');\n\n    panelDragData = {\n      startX: clientX,\n      startY: clientY,\n      initialLeft: rect.left,\n      initialTop: rect.top,\n    };\n    $(panel!).addClass('dragging');\n    $(header!).addClass('dragging');\n    console.log('âœ… é¢æ¿æ‹–åŠ¨æ•°æ®å·²è®¾ç½®:', panelDragData);\n  }\n\n  function handlePanelDragMove(clientX: number, clientY: number): void {\n    if (!panelDragData) return;\n\n    const deltaX = clientX - panelDragData.startX;\n    const deltaY = clientY - panelDragData.startY;\n    const newLeft = panelDragData.initialLeft + deltaX;\n    const newTop = panelDragData.initialTop + deltaY;\n\n    panel!.style.setProperty('left', `${newLeft}px`, 'important');\n    panel!.style.setProperty('top', `${newTop}px`, 'important');\n  }\n\n  function handlePanelDragEnd(): void {\n    console.log('ğŸ–±ï¸ é¢æ¿æ‹–åŠ¨ç»“æŸ');\n    if (panelDragData) {\n      const rect = panel!.getBoundingClientRect();\n      const savedPosition = {\n        left: rect.left,\n        top: rect.top,\n      };\n      localStorage.setItem('ngq-panel-position', JSON.stringify(savedPosition));\n      console.log('âœ… é¢æ¿æ‹–åŠ¨ç»“æŸï¼Œä¿å­˜ä½ç½®:', savedPosition);\n    }\n\n    panelDragData = null;\n    $(panel!).removeClass('dragging');\n    $(header!).removeClass('dragging');\n  }\n\n  // é¼ æ ‡äº‹ä»¶\n  $(header!).on('mousedown.ngq-panel-drag', function (e) {\n    if ($(e.target).closest('#ngq-close-btn').length > 0) {\n      console.log('âš ï¸ ç‚¹å‡»äº†å…³é—­æŒ‰é’®ï¼Œè·³è¿‡æ‹–åŠ¨');\n      return;\n    }\n    e.preventDefault();\n    handlePanelDragStart(e.clientX, e.clientY);\n  });\n\n  $targetDoc.on('mousemove.ngq-panel-drag', function (e) {\n    handlePanelDragMove(e.clientX, e.clientY);\n  });\n\n  $targetDoc.on('mouseup.ngq-panel-drag', function () {\n    handlePanelDragEnd();\n  });\n\n  // è§¦æ‘¸äº‹ä»¶\n  $(header!).on('touchstart.ngq-panel-drag', function (e) {\n    if ($(e.target).closest('#ngq-close-btn').length > 0) {\n      console.log('âš ï¸ è§¦æ‘¸äº†å…³é—­æŒ‰é’®ï¼Œè·³è¿‡æ‹–åŠ¨');\n      return;\n    }\n    const touch = e.originalEvent!.touches[0];\n    if (touch) {\n      e.preventDefault();\n      handlePanelDragStart(touch.clientX, touch.clientY);\n    }\n  });\n\n  $targetDoc.on('touchmove.ngq-panel-drag', function (e) {\n    const touch = e.originalEvent!.touches[0];\n    if (touch) {\n      handlePanelDragMove(touch.clientX, touch.clientY);\n    }\n  });\n\n  $targetDoc.on('touchend.ngq-panel-drag touchcancel.ngq-panel-drag', function () {\n    handlePanelDragEnd();\n  });\n\n  // æ¢å¤ä¿å­˜çš„ä½ç½®\n  const savedPos = localStorage.getItem('ngq-panel-position');\n  if (savedPos) {\n    try {\n      const pos = JSON.parse(savedPos);\n      panel!.style.setProperty('transform', 'none', 'important');\n      panel!.style.setProperty('left', `${pos.left}px`, 'important');\n      panel!.style.setProperty('top', `${pos.top}px`, 'important');\n      console.log('âœ… å·²æ¢å¤é¢æ¿ä½ç½®:', pos);\n    } catch (e) {\n      console.error('âŒ æ¢å¤é¢æ¿ä½ç½®å¤±è´¥:', e);\n    }\n  }\n\n  console.log('âœ… é¢æ¿æ‹–åŠ¨åŠŸèƒ½å·²åˆå§‹åŒ–');\n}\n\n// ==================== é¢æ¿ç³»ç»Ÿ ====================\nfunction initializePanelSystem(targetDoc: Document): void {\n  const closeBtn = targetDoc.getElementById('ngq-close-btn');\n  if (closeBtn) {\n    closeBtn.addEventListener('click', e => {\n      e.stopPropagation();\n      const panel = targetDoc.getElementById('ngq-main-panel');\n      if (panel) {\n        panel.classList.remove('active');\n      }\n    });\n  }\n\n  // åˆå§‹åŒ–é¢æ¿æ‹–åŠ¨\n  initializePanelDrag(targetDoc);\n\n  console.log('âœ… é¢æ¿ç³»ç»Ÿå·²åˆå§‹åŒ–');\n}\n\n// ==================== æ•°æ®åŠ è½½ ====================\nasync function loadNgqData(targetDoc: Document): Promise<void> {\n  try {\n    // æ£€æŸ¥ MVU æ˜¯å¦å¯ç”¨\n    if (typeof Mvu === 'undefined') {\n      try {\n        if (window.parent && typeof (window.parent as any).Mvu !== 'undefined') {\n          (window as any).Mvu = (window.parent as any).Mvu;\n          console.log('âœ… å·²ä»çˆ¶çª—å£å¼•ç”¨ MVU');\n        } else {\n          throw new Error('çˆ¶çª—å£ä¸­ä¹Ÿæ²¡æœ‰ MVU');\n        }\n      } catch (e) {\n        console.warn('âš ï¸ MVU æ¡†æ¶æœªåŠ è½½æˆ–æ— æ³•è®¿é—®çˆ¶çª—å£');\n        if (currentRetry < MAX_RETRIES) {\n          currentRetry++;\n          console.log(`ğŸ”„ ç¬¬ ${currentRetry}/${MAX_RETRIES} æ¬¡é‡è¯•åŠ è½½ MVU...`);\n          setTimeout(() => loadNgqData(targetDoc), RETRY_DELAY);\n        } else {\n          showError(targetDoc, 'MVU æ¡†æ¶æœªåŠ è½½ï¼Œè¯·ç¡®ä¿å·²å®‰è£…é…’é¦†åŠ©æ‰‹å¹¶å¯ç”¨ MVU æ¡†æ¶');\n        }\n        return;\n      }\n    }\n\n    // è·å–æœ€æ–°æ¶ˆæ¯çš„ MVU æ•°æ®\n    const mvuResult = Mvu.getMvuData({\n      type: 'message',\n      message_id: 'latest',\n    });\n\n    const data = mvuResult?.stat_data;\n\n    if (!data) {\n      console.warn('âš ï¸ MVU æ•°æ®ä¸ºç©º');\n      if (currentRetry < MAX_RETRIES) {\n        currentRetry++;\n        setTimeout(() => loadNgqData(targetDoc), RETRY_DELAY);\n      } else {\n        showError(targetDoc, 'æœªèƒ½åŠ è½½æ•°æ®');\n      }\n      return;\n    }\n\n    cachedMVUData = data;\n    console.log('âœ… æ•°æ®åŠ è½½æˆåŠŸ', data);\n\n    // æ¸²æŸ“æ•°æ®\n    renderNgqData(targetDoc, data);\n  } catch (error) {\n    console.error('âŒ åŠ è½½æ•°æ®å‡ºé”™:', error);\n    showError(targetDoc, 'åŠ è½½å‡ºé”™: ' + (error as Error).message);\n  }\n}\n\nfunction showError(targetDoc: Document, message: string): void {\n  const contentDiv = targetDoc.getElementById('ngq-content');\n  if (contentDiv) {\n    contentDiv.innerHTML = `\n      <div class=\"ngq-empty\">\n        <div class=\"ngq-empty-icon\">âš ï¸</div>\n        <div class=\"ngq-empty-text\">${message}</div>\n      </div>\n    `;\n  }\n}\n\n// ==================== æ•°æ®æ¸²æŸ“ ====================\nfunction renderNgqData(targetDoc: Document, data: AnyObject): void {\n  const contentDiv = targetDoc.getElementById('ngq-content');\n  const timeDisplay = targetDoc.getElementById('ngq-time-display');\n\n  if (!contentDiv) return;\n\n  // æ›´æ–°æ—¶é—´æ˜¾ç¤º\n  if (timeDisplay) {\n    const date =\n      `${safeGetValue(data, 'ä¸–ç•Œ.å¹´ä»½', '')} ${safeGetValue(data, 'ä¸–ç•Œ.æ—¥æœŸ', '')} ${safeGetValue(data, 'ä¸–ç•Œ.æ˜ŸæœŸ', '')}`.trim();\n    const time = safeGetValue(data, 'ä¸–ç•Œ.æ—¶é—´', '');\n    const location = safeGetValue(data, 'ä¸–ç•Œ.åœ°ç‚¹', 'ä¸œæµ·å¸‚Â·èŸèƒåŸ');\n    timeDisplay.textContent = `${location} | ${date} ${time}`;\n  }\n\n  // æ„å»º HTML\n  const html = renderOverviewPage(data);\n\n  contentDiv.innerHTML = html;\n\n  // åªåœ¨ç¬¬ä¸€æ¬¡ç»‘å®šäº‹ä»¶ï¼ˆé¿å…é‡å¤ç»‘å®šå¯¼è‡´å¤šæ¬¡è§¦å‘ï¼‰\n  if (!contentEventsInitialized) {\n    initializeContentEvents(targetDoc);\n    contentEventsInitialized = true;\n    console.log('âœ… å†…å®¹åŒºäº‹ä»¶å·²ç»‘å®šï¼ˆé¦–æ¬¡ï¼‰');\n  }\n}\n\n// ==================== æ¸²æŸ“æ€»è§ˆé¡µé¢ ====================\nfunction renderOverviewPage(data: AnyObject): string {\n  if (!data) {\n    return '<div class=\"ngq-empty\"><div class=\"ngq-empty-icon\">ğŸ“­</div><div>æš‚æ— æ•°æ®</div></div>';\n  }\n\n  const cfg = data?.å…¬å¯“?.æ¥¼å±‚é…ç½® || {};\n  const rooms = (data?.å…¬å¯“?.æˆ¿é—´åˆ—è¡¨ && data.å…¬å¯“.æˆ¿é—´åˆ—è¡¨[0]) || {};\n\n  const floors = Object.keys(cfg)\n    .filter(k => k !== '$meta')\n    .map(k => ({\n      key: k,\n      order: parseFloat(safeGetValue(cfg[k], 'é¡ºåº', '0')) || 0,\n      name: safeGetValue(cfg[k], 'æ˜¾ç¤ºåç§°', k),\n      capacity: safeGetValue(cfg[k], 'æ€»å®¹é‡', '10'),\n    }))\n    .sort((a, b) => b.order - a.order);\n\n  if (floors.length === 0) {\n    return '<div class=\"ngq-empty\"><div class=\"ngq-empty-icon\">ğŸ—ï¸</div><div>æœªæ‰¾åˆ°æ¥¼å±‚æ•°æ®</div></div>';\n  }\n\n  let html = '<div style=\"display:flex;flex-direction:column;gap:12px\">';\n\n  floors.forEach(floor => {\n    html += renderSingleFloor(floor, rooms);\n  });\n\n  html += '</div>';\n\n  // æ·»åŠ æ“ä½œæŒ‰é’®\n  html += `\n    <div class=\"ngq-card\" style=\"margin-top:16px\">\n      <div class=\"ngq-card-title\">\n        <span>ğŸ¢</span>\n        <span>å°åŒºç®¡ç†</span>\n      </div>\n      <div class=\"ngq-card-body\">\n        <div class=\"ngq-management-actions\">\n          <button class=\"ngq-btn\" data-action=\"recruit\">ğŸ‘¤ æ‹›å‹Ÿæ–°ç§Ÿå®¢</button>\n          <button class=\"ngq-btn\" data-action=\"buy-floor\">ğŸ—ï¸ è´­ç½®æ–°æ¥¼å±‚</button>\n        </div>\n        <div class=\"ngq-management-actions\" style=\"margin-top:12px\">\n          <button class=\"ngq-btn\" data-action=\"refresh\">ğŸ”„ åˆ·æ–°æ•°æ®</button>\n          <button class=\"ngq-btn\" data-action=\"auto-refresh\" id=\"auto-refresh-btn\">â±ï¸ è‡ªåŠ¨åˆ·æ–°: å…³</button>\n        </div>\n        <div style=\"margin-top:12px;padding:12px;background:rgba(255,107,157,0.1);border-radius:8px;font-size:13px;color:var(--apt-dim);line-height:1.5\">\n          ğŸ’¡ æç¤ºï¼šè´­ç½®æ–°æ¥¼å±‚å°†åŒæ—¶å»ºé€ 4ä¸ªå…¬å¯“å•å…ƒï¼ˆå¦‚å››æ¥¼ï¼š401/402/403/404ï¼‰\n        </div>\n      </div>\n    </div>\n  `;\n\n  return html;\n}\n\nfunction renderSingleFloor(floor: any, rooms: any): string {\n  let html = `<div class=\"ngq-floor-level\">`;\n  html += `<div class=\"ngq-floor-level-title\">ğŸ¢ ${floor.name}</div>`;\n  html += `<div class=\"ngq-floor-grid\">`;\n\n  const floorRooms: Array<{ name: string; type: string; tenant: string; position: string }> = [];\n  const roomKeys = Object.keys(rooms).filter(k => k !== '$meta');\n\n  roomKeys.forEach(roomKey => {\n    const r = rooms[roomKey];\n    const layout = r?.å¸ƒå±€;\n    if (!layout || typeof layout !== 'object') return;\n\n    const floorName = typeof layout.æ¥¼å±‚ === 'string' ? layout.æ¥¼å±‚ : String(layout.æ¥¼å±‚ || '');\n    if (floorName !== floor.name) return;\n\n    const type = safeGetValue(r, 'ç±»å‹', 'å¥—é—´');\n    const tenant = safeGetValue(r, 'ä½æˆ·', 'æœªçŸ¥');\n    const position = typeof layout.ä½ç½® === 'string' ? layout.ä½ç½® : String(layout.ä½ç½® || '');\n    floorRooms.push({ name: roomKey, type, tenant, position });\n  });\n\n  // æŒ‰å•å…ƒå·æ’åºï¼šA/B/C/DåŒºï¼ˆ01/02/03/04ï¼‰\n  floorRooms.sort((a, b) => {\n    const getOrder = (pos: string) => {\n      if (pos.includes('AåŒº') || pos.includes('01')) return 1;\n      if (pos.includes('BåŒº') || pos.includes('02')) return 2;\n      if (pos.includes('CåŒº') || pos.includes('03')) return 3;\n      if (pos.includes('DåŒº') || pos.includes('04')) return 4;\n      return 0;\n    };\n    const orderDiff = getOrder(a.position) - getOrder(b.position);\n    return orderDiff !== 0 ? orderDiff : a.name.localeCompare(b.name);\n  });\n\n  if (floorRooms.length === 0) {\n    html += `<div style=\"padding:20px;text-align:center;color:var(--apt-dim)\">è¯¥æ¥¼å±‚æš‚æ— æˆ¿é—´</div>`;\n    html += `</div></div>`;\n    return html;\n  }\n\n  // åˆå¹¶ç›¸é‚»çš„åŒç±»å‹å…¬å…±è®¾æ–½\n  const mergedRooms: Array<{\n    rooms: string[];\n    type: string;\n    tenant: string;\n    isMerged: boolean;\n  }> = [];\n  const skipIndices = new Set<number>();\n\n  for (let i = 0; i < floorRooms.length; i++) {\n    if (skipIndices.has(i)) continue;\n\n    const currentRoom = floorRooms[i];\n    const isPublic = ['å…¬å…±å®¢å…', 'å¥èº«æˆ¿'].includes(currentRoom.type);\n\n    // æ£€æŸ¥ä¸‹ä¸€ä¸ªæˆ¿é—´æ˜¯å¦æ˜¯ç›¸åŒç±»å‹çš„å…¬å…±è®¾æ–½\n    if (isPublic && i + 1 < floorRooms.length) {\n      const nextRoom = floorRooms[i + 1];\n      if (nextRoom.type === currentRoom.type) {\n        // åˆå¹¶ä¸¤ä¸ªæˆ¿é—´\n        mergedRooms.push({\n          rooms: [currentRoom.name, nextRoom.name],\n          type: currentRoom.type,\n          tenant: currentRoom.tenant,\n          isMerged: true,\n        });\n        skipIndices.add(i + 1);\n        continue;\n      }\n    }\n\n    // ä¸åˆå¹¶ï¼Œå•ç‹¬æ˜¾ç¤º\n    mergedRooms.push({\n      rooms: [currentRoom.name],\n      type: currentRoom.type,\n      tenant: currentRoom.tenant,\n      isMerged: false,\n    });\n  }\n\n  // æ¸²æŸ“æˆ¿é—´ï¼ˆåŒ…æ‹¬åˆå¹¶çš„ï¼‰\n  mergedRooms.forEach(roomGroup => {\n    const isYourRoom = roomGroup.type === 'æ‚¨çš„æˆ¿é—´';\n    const isEmptyRoom = roomGroup.type === 'ç©ºæˆ¿é—´';\n    const isSuite = roomGroup.type === 'å¥—é—´';\n    const isPublicLounge = roomGroup.type === 'å…¬å…±å®¢å…';\n    const isPublicGym = roomGroup.type === 'å¥èº«æˆ¿';\n    const isPublicLaundry = roomGroup.type === 'æ´—è¡£é—´';\n    const isDefaultPublic = isPublicLounge || isPublicGym || isPublicLaundry;\n    // ç”¨æˆ·è‡ªå®šä¹‰åŠŸèƒ½æ€§æˆ¿é—´ï¼šä¸æ˜¯å¥—é—´ã€ä¸æ˜¯æ‚¨çš„æˆ¿é—´ã€ä¸æ˜¯ç©ºæˆ¿é—´ã€ä¹Ÿä¸æ˜¯é»˜è®¤å…¬å…±è®¾æ–½\n    const isCustomFunctional = !isSuite && !isYourRoom && !isEmptyRoom && !isDefaultPublic;\n    const isVacant = roomGroup.tenant === 'æœªçŸ¥' && isSuite;\n\n    let cls = '';\n    if (isYourRoom) cls = 'your';\n    else if (isEmptyRoom) cls = 'empty';\n    else if (isPublicLounge) cls = 'public-lounge';\n    else if (isPublicGym) cls = 'public-gym';\n    else if (isPublicLaundry) cls = 'public-laundry';\n    else if (isCustomFunctional) cls = 'custom-functional';\n    else if (isVacant) cls = 'bedroom vacant';\n    else cls = 'bedroom';\n\n    if (roomGroup.isMerged) cls += ' merged';\n\n    const tenantDisplay = roomGroup.tenant === '<user>' ? 'æˆ¿ä¸œ' : roomGroup.tenant === 'æœªçŸ¥' ? '' : roomGroup.tenant;\n\n    // å›¾æ ‡é€‰æ‹©\n    let roomIcon = 'ğŸ ';\n    if (isYourRoom) roomIcon = 'ğŸ‘‘';\n    else if (isEmptyRoom) roomIcon = 'ğŸ”§';\n    else if (isPublicLounge) roomIcon = 'ğŸ›‹ï¸';\n    else if (isPublicGym) roomIcon = 'ğŸ’ª';\n    else if (isPublicLaundry) roomIcon = 'ğŸ§º';\n    else if (isCustomFunctional) roomIcon = 'ğŸ¢'; // ç”¨æˆ·è‡ªå®šä¹‰åŠŸèƒ½æ€§æˆ¿é—´ä½¿ç”¨å»ºç­‘å›¾æ ‡\n\n    // æˆ¿é—´åç§°æ˜¾ç¤º\n    const roomName = roomGroup.isMerged ? `${roomGroup.rooms[0]}-${roomGroup.rooms[1]}` : roomGroup.rooms[0];\n\n    // æˆ¿é—´ç±»å‹æ ‡ç­¾\n    let typeLabel = '';\n    if (isPublicLounge) typeLabel = 'å…¬å…±å®¢å…';\n    else if (isPublicGym) typeLabel = 'å¥èº«æˆ¿';\n    else if (isPublicLaundry) typeLabel = 'æ´—è¡£é—´';\n    else if (isCustomFunctional) typeLabel = roomGroup.type; // ç”¨æˆ·è‡ªå®šä¹‰åŠŸèƒ½æ€§æˆ¿é—´æ˜¾ç¤ºç±»å‹åç§°\n\n    html += `<div class=\"ngq-room-card ${cls}\" data-room=\"${roomGroup.rooms[0]}\" data-room-type=\"${roomGroup.type}\" data-room-tenant=\"${roomGroup.tenant}\">`;\n    html += `<div class=\"ngq-room-name\">${roomIcon} ${roomName}</div>`;\n    if (isYourRoom) {\n      html += `<div class=\"ngq-room-occupant\">ğŸ”‘ æˆ¿ä¸œè‡ªä½</div>`;\n    } else if (isEmptyRoom) {\n      html += `<div class=\"ngq-room-occupant\">ğŸ”¨ æœªè£…ä¿®</div>`;\n    } else if (isDefaultPublic) {\n      html += `<div class=\"ngq-room-occupant\">âœ¨ ${typeLabel}</div>`;\n    } else if (isCustomFunctional) {\n      html += `<div class=\"ngq-room-occupant\">ğŸ¨ ${typeLabel}</div>`; // æ˜¾ç¤ºæˆ¿é—´åç§°\n    } else if (tenantDisplay) {\n      html += `<div class=\"ngq-room-occupant\">ğŸ‘¤ ${tenantDisplay}</div>`;\n    } else {\n      html += `<div class=\"ngq-room-occupant\">ğŸ·ï¸ å¾…å‡ºç§Ÿ</div>`;\n    }\n    html += `</div>`;\n  });\n\n  html += `</div></div>`;\n  return html;\n}\n\n// ==================== å†…å®¹äº‹ä»¶ç»‘å®š ====================\n// æ³¨æ„ï¼šæ­¤å‡½æ•°åªåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œé¿å…é‡å¤ç»‘å®šäº‹ä»¶å¯¼è‡´å¤šæ¬¡è§¦å‘\nfunction initializeContentEvents(targetDoc: Document): void {\n  const content = targetDoc.getElementById('ngq-content');\n  if (!content) return;\n\n  // æˆ¿é—´å¡ç‰‡ç‚¹å‡»äº‹ä»¶\n  content.addEventListener('click', e => {\n    const target = e.target as HTMLElement;\n    const roomCard = target.closest('.ngq-room-card') as HTMLElement;\n    if (roomCard) {\n      e.preventDefault();\n      e.stopPropagation();\n      const roomName = roomCard.getAttribute('data-room');\n      const roomType = roomCard.getAttribute('data-room-type');\n      const roomTenant = roomCard.getAttribute('data-room-tenant');\n      console.log('ğŸ–±ï¸ ç‚¹å‡»æˆ¿é—´å¡ç‰‡:', { roomName, roomType, roomTenant });\n      console.log('ğŸ” roomCard HTML:', roomCard.outerHTML.substring(0, 200));\n      if (roomName) {\n        // å¦‚æœæ˜¯ç©ºæˆ¿é—´ï¼Œæ‰“å¼€è£…ä¿®é€‰æ‹©æ¨¡æ€æ¡†\n        if (roomType === 'ç©ºæˆ¿é—´') {\n          console.log('âœ… æ£€æµ‹åˆ°ç©ºæˆ¿é—´ï¼Œæ‰“å¼€è£…ä¿®é€‰æ‹©æ¨¡æ€æ¡†');\n          openRenovateModal(targetDoc, roomName);\n        } else {\n          // å¦åˆ™æ‰“å¼€æˆ¿é—´è¯¦æƒ…æ¨¡æ€æ¡†\n          console.log('âœ… æ‰“å¼€æˆ¿é—´è¯¦æƒ…æ¨¡æ€æ¡†');\n          openRoomModal(targetDoc, roomName, roomType || '', roomTenant || '');\n        }\n      } else {\n        console.warn('âš ï¸ roomName ä¸ºç©ºï¼Œæ— æ³•æ‰“å¼€æ¨¡æ€æ¡†');\n      }\n      return;\n    }\n  });\n\n  // æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆä½¿ç”¨äº‹ä»¶å§”æ‰˜ï¼‰\n  content.addEventListener('click', e => {\n    const target = e.target as HTMLElement;\n    if (!target.matches('button[data-action]')) return;\n\n    const action = target.getAttribute('data-action');\n    const name = target.getAttribute('data-name');\n\n    if (action === 'favor-add' && name) {\n      e.preventDefault();\n      e.stopPropagation();\n      fillCommand(`_.add('ç§Ÿå®¢åˆ—è¡¨[0].${name}.å¥½æ„Ÿåº¦[0]', 5); // äº¤äº’å‹å¥½ï¼Œç•¥å¾®æå‡å¥½æ„Ÿ`);\n    } else if (action === 'recruit') {\n      e.preventDefault();\n      e.stopPropagation();\n      openRecruitmentModal(targetDoc);\n    } else if (action === 'buy-floor') {\n      e.preventDefault();\n      e.stopPropagation();\n      fillCommand(`è´­ç½®æ–°æ¥¼å±‚ï¼ˆéœ€åŒæ—¶å»ºé€ 4ä¸ªå…¬å¯“å•å…ƒï¼š01/02/03/04ï¼‰`);\n    } else if (action === 'refresh') {\n      e.preventDefault();\n      e.stopPropagation();\n      void loadNgqData(targetDoc);\n    } else if (action === 'auto-refresh') {\n      e.preventDefault();\n      e.stopPropagation();\n      if (autoRefreshTimer) {\n        clearInterval(autoRefreshTimer);\n        autoRefreshTimer = null;\n        target.textContent = 'â±ï¸ è‡ªåŠ¨åˆ·æ–°: å…³';\n      } else {\n        autoRefreshTimer = window.setInterval(() => {\n          void loadNgqData(targetDoc);\n        }, 4000);\n        target.textContent = 'â±ï¸ è‡ªåŠ¨åˆ·æ–°: å¼€';\n      }\n    }\n  });\n}\n\n// ==================== æ¨¡æ€æ¡†åŠŸèƒ½ ====================\nfunction openRecruitmentModal(targetDoc: Document): void {\n  const modal = targetDoc.getElementById('ngq-recruitment-modal');\n  const input = targetDoc.getElementById('ngq-recruitment-keywords') as HTMLInputElement;\n  if (modal && input) {\n    modal.classList.remove('hidden');\n    // æ¸…ç©ºè¾“å…¥æ¡†å¹¶èšç„¦\n    input.value = '';\n    setTimeout(() => {\n      input.focus();\n    }, 100);\n  }\n}\n\nfunction closeRecruitmentModal(targetDoc: Document): void {\n  const modal = targetDoc.getElementById('ngq-recruitment-modal');\n  if (modal) {\n    modal.classList.add('hidden');\n  }\n}\n\nfunction confirmRecruitment(targetDoc: Document): void {\n  const input = targetDoc.getElementById('ngq-recruitment-keywords') as HTMLInputElement;\n  if (input) {\n    const keywords = input.value.trim();\n    if (keywords) {\n      fillCommand(`æ‹›å‹Ÿä¸€åç¬¦åˆä»¥ä¸‹ç‰¹å¾çš„ç§Ÿå®¢ï¼š${keywords}`);\n    } else {\n      alert('è¯·è¾“å…¥ç§Ÿå®¢ç‰¹å¾åå†ç¡®è®¤ã€‚');\n      return;\n    }\n    closeRecruitmentModal(targetDoc);\n  }\n}\n\n// æˆ¿é—´è¯¦æƒ…æ¨¡æ€æ¡†\nfunction openRoomModal(targetDoc: Document, roomName: string, roomType: string, tenantName: string): void {\n  const modal = targetDoc.getElementById('ngq-room-modal');\n  const title = targetDoc.getElementById('ngq-room-modal-title');\n  const body = targetDoc.getElementById('ngq-room-modal-body');\n\n  if (!modal || !title || !body || !cachedMVUData) return;\n\n  // è·å–å®Œæ•´æˆ¿é—´æ•°æ®\n  const roomData = cachedMVUData?.å…¬å¯“?.æˆ¿é—´åˆ—è¡¨?.[0]?.[roomName];\n\n  // è®¾ç½®æ ‡é¢˜\n  const isYourRoom = roomType === 'æ‚¨çš„æˆ¿é—´';\n  const isPublicLounge = roomType === 'å…¬å…±å®¢å…';\n  const isPublicGym = roomType === 'å¥èº«æˆ¿';\n  const isPublicLaundry = roomType === 'æ´—è¡£é—´';\n  const isPublic = isPublicLounge || isPublicGym || isPublicLaundry;\n\n  let roomIcon = 'ğŸ ';\n  if (isYourRoom) roomIcon = 'ğŸ‘‘';\n  else if (isPublicLounge) roomIcon = 'ğŸ›‹ï¸';\n  else if (isPublicGym) roomIcon = 'ğŸ’ª';\n  else if (isPublicLaundry) roomIcon = 'ğŸ§º';\n\n  title.textContent = `${roomIcon} ${roomName}`;\n\n  // æ„å»ºå†…å®¹\n  let content = '';\n\n  if (!roomData) {\n    content = '<div class=\"ngq-empty\"><div class=\"ngq-empty-icon\">â“</div><div>æˆ¿é—´æ•°æ®ä¸å­˜åœ¨</div></div>';\n  } else {\n    // æˆ¿é—´åŸºæœ¬ä¿¡æ¯\n    content += '<div style=\"margin-bottom:16px\">';\n    content += `<div class=\"ngq-info-row\"><span class=\"ngq-info-label\">æˆ¿é—´ç±»å‹</span><span class=\"ngq-info-value\">${roomType}</span></div>`;\n\n    const layout = roomData?.å¸ƒå±€;\n    if (layout && typeof layout === 'object') {\n      const floor = layout.æ¥¼å±‚ || 'æœªçŸ¥';\n      const position = layout.ä½ç½® || 'æœªçŸ¥';\n      const positionIcon =\n        position === 'AåŒº'\n          ? 'ğŸ…° AåŒº'\n          : position === 'BåŒº'\n            ? 'ğŸ…± BåŒº'\n            : position === 'CåŒº'\n              ? 'ğŸ…² CåŒº'\n              : position === 'DåŒº'\n                ? 'ğŸ…³ DåŒº'\n                : position;\n      content += `<div class=\"ngq-info-row\"><span class=\"ngq-info-label\">æ‰€åœ¨æ¥¼å±‚</span><span class=\"ngq-info-value\">${floor}</span></div>`;\n      content += `<div class=\"ngq-info-row\"><span class=\"ngq-info-label\">ä½ç½®</span><span class=\"ngq-info-value\">${positionIcon}</span></div>`;\n    }\n\n    const desc = safeGetValue(roomData, 'æè¿°', '');\n    if (desc) {\n      content += `<div class=\"ngq-info-row\" style=\"display:block\"><span class=\"ngq-info-label\">æˆ¿é—´æè¿°</span><div style=\"margin-top:6px;color:var(--apt-text);line-height:1.5\">${desc}</div></div>`;\n    }\n\n    content += '</div>';\n\n    // å¦‚æœæ˜¯å¥—é—´ä¸”æœ‰ç§Ÿå®¢ï¼Œæ˜¾ç¤ºç§Ÿå®¢ä¿¡æ¯\n    if (roomType === 'å¥—é—´' && tenantName && tenantName !== 'æœªçŸ¥') {\n      const tenantData = cachedMVUData?.ç§Ÿå®¢åˆ—è¡¨?.[0]?.[tenantName];\n\n      if (tenantData) {\n        content += '<div style=\"border-top:1px solid var(--apt-border);padding-top:16px;margin-top:8px\">';\n        content +=\n          '<div style=\"font-size:1.1em;font-weight:600;margin-bottom:12px;color:var(--apt-primary)\">ğŸ‘¤ ç§Ÿå®¢ä¿¡æ¯</div>';\n\n        const age = safeGetValue(tenantData, 'å¹´é¾„', '-');\n        const job = safeGetValue(tenantData, 'èŒä¸š', '-');\n        const creatorType = safeGetValue(tenantData, 'åˆ›ä½œå†…å®¹', '-');\n        const appearance = safeGetValue(tenantData, 'å¤–è²Œ', '-');\n        const personality = safeGetValue(tenantData, 'æ€§æ ¼', '-');\n        const favorValue = parseInt(safeGetValue(tenantData, 'å¥½æ„Ÿåº¦', '0')) || 0;\n        const lustValue = parseInt(safeGetValue(tenantData, 'æ€§æ¬²', '0')) || 0;\n        const days = safeGetValue(tenantData, 'å…¥ä½å¤©æ•°', '0');\n        const state = safeGetValue(tenantData, 'çŠ¶æ€', '-');\n        const mood = safeGetValue(tenantData, 'å†…å¿ƒ', '-');\n\n        // åŸºæœ¬ä¿¡æ¯\n        content += `<div class=\"ngq-info-row\"><span class=\"ngq-info-label\">å§“å</span><span class=\"ngq-info-value\">${tenantName}</span></div>`;\n        content += `<div class=\"ngq-info-row\"><span class=\"ngq-info-label\">å¹´é¾„</span><span class=\"ngq-info-value\">${age}å²</span></div>`;\n        content += `<div class=\"ngq-info-row\"><span class=\"ngq-info-label\">èŒä¸š</span><span class=\"ngq-info-value\">ğŸ“± ${job}</span></div>`;\n        content += `<div class=\"ngq-info-row\"><span class=\"ngq-info-label\">åˆ›ä½œå†…å®¹</span><span class=\"ngq-info-value\">âœ¨ ${creatorType}</span></div>`;\n\n        // å¥½æ„Ÿåº¦è¿›åº¦æ¡\n        content += `<div class=\"ngq-info-block\">`;\n        content += `<span class=\"ngq-info-label\">â¤ï¸ å¥½æ„Ÿåº¦</span>`;\n        content += `<div class=\"ngq-progress-bar\">`;\n        content += `<div class=\"ngq-progress-fill favor\" style=\"width:${favorValue}%\">${favorValue}</div>`;\n        content += `</div></div>`;\n\n        // æ€§æ¬²è¿›åº¦æ¡\n        content += `<div class=\"ngq-info-block\">`;\n        content += `<span class=\"ngq-info-label\">ğŸ”¥ æ€§æ¬²</span>`;\n        content += `<div class=\"ngq-progress-bar\">`;\n        content += `<div class=\"ngq-progress-fill lust\" style=\"width:${lustValue}%\">${lustValue}</div>`;\n        content += `</div></div>`;\n\n        // é•¿æ–‡æœ¬ä¿¡æ¯ï¼ˆå—çº§æ˜¾ç¤ºï¼‰\n        content += `<div class=\"ngq-info-block\"><span class=\"ngq-info-label\">å¤–è²Œç‰¹å¾</span><div class=\"ngq-info-value\">${appearance}</div></div>`;\n        content += `<div class=\"ngq-info-block\"><span class=\"ngq-info-label\">æ€§æ ¼</span><div class=\"ngq-info-value\">${personality}</div></div>`;\n        content += `<div class=\"ngq-info-block\"><span class=\"ngq-info-label\">å½“å‰çŠ¶æ€</span><div class=\"ngq-info-value\">${state}</div></div>`;\n        content += `<div class=\"ngq-info-block\"><span class=\"ngq-info-label\">å†…å¿ƒæƒ³æ³•</span><div class=\"ngq-info-value\">${mood}</div></div>`;\n\n        // å…¶ä»–ä¿¡æ¯ï¼ˆè¡Œå†…æ˜¾ç¤ºï¼‰\n        content += `<div class=\"ngq-info-row\"><span class=\"ngq-info-label\">å…¥ä½å¤©æ•°</span><span class=\"ngq-info-value\">ğŸ“… ${days}å¤©</span></div>`;\n\n        content += '</div>';\n      }\n    } else if (roomType === 'å¥—é—´') {\n      content += '<div style=\"text-align:center;padding:20px;color:var(--apt-dim)\">ğŸ  è¯¥å¥—é—´æš‚æ— ç§Ÿå®¢å…¥ä½</div>';\n    } else if (isYourRoom) {\n      content += '<div style=\"text-align:center;padding:20px;color:var(--apt-dim)\">ğŸ‘‘ è¿™æ˜¯æ‚¨çš„ç§äººå¥—é—´</div>';\n    } else if (isPublic) {\n      // æ˜¾ç¤ºå…¬å…±è®¾æ–½ä¿¡æ¯\n      const desc = typeof roomData?.æè¿° === 'string' ? roomData.æè¿° : '';\n      const funcArea = typeof roomData?.åŠŸèƒ½åŒº === 'string' ? roomData.åŠŸèƒ½åŒº : '';\n\n      // æ ¹æ®è®¾æ–½ç±»å‹è®¾ç½®æ ‡é¢˜é¢œè‰²\n      let facilityColor = 'var(--apt-primary)';\n      let facilityIcon = 'âœ¨';\n      if (isPublicLounge) {\n        facilityColor = '#f59e0b';\n        facilityIcon = 'ğŸ›‹ï¸';\n      } else if (isPublicGym) {\n        facilityColor = '#10b981';\n        facilityIcon = 'ğŸ’ª';\n      } else if (isPublicLaundry) {\n        facilityColor = '#0ea5e9';\n        facilityIcon = 'ğŸ§º';\n      }\n\n      content += `<div style=\"text-align:center;padding:20px;color:var(--apt-text)\">`;\n      content += `<div style=\"font-size:16px;font-weight:600;color:${facilityColor};margin-bottom:16px\">${facilityIcon} ${roomType}</div>`;\n      if (desc) {\n        content += `<div style=\"margin-bottom:12px;font-size:14px;color:var(--apt-dim);line-height:1.6\">${desc}</div>`;\n      }\n      if (funcArea) {\n        content += `<div style=\"font-size:13px;color:${facilityColor};margin-top:12px;padding:8px;background:rgba(255,255,255,0.05);border-radius:6px\">ğŸ”§ ${funcArea}</div>`;\n      }\n      content += `<div style=\"margin-top:16px;font-size:13px;color:var(--apt-dim);padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px dashed ${facilityColor}\">âœ¨ å…è´¹å¯¹æ‰€æœ‰ç§Ÿå®¢å¼€æ”¾</div>`;\n      content += `</div>`;\n    }\n  }\n\n  body.innerHTML = content;\n\n  // åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºæ‹†é™¤æŒ‰é’®\n  const demolishActionsDiv = targetDoc.getElementById('ngq-room-demolish-actions');\n  if (demolishActionsDiv) {\n    // é»˜è®¤å…¬å…±è®¾æ–½æˆ¿é—´å·ï¼ˆä¸å¯æ‹†é™¤ï¼‰\n    const defaultPublicRooms = ['101', '102', '103', '104', '204', '304'];\n\n    // åˆ¤æ–­æ˜¯å¦å¯æ‹†é™¤\n    const canDemolish =\n      !isYourRoom && // ä¸æ˜¯ç”¨æˆ·çš„æˆ¿é—´\n      !defaultPublicRooms.includes(roomName) && // ä¸æ˜¯é»˜è®¤å…¬å…±è®¾æ–½\n      (roomType === 'å¥—é—´' ? tenantName === 'æœªçŸ¥' : true); // å¥—é—´éœ€æ— äººå…¥ä½\n\n    if (canDemolish) {\n      demolishActionsDiv.style.display = 'flex';\n      currentRoomForDemolish = roomName;\n    } else {\n      demolishActionsDiv.style.display = 'none';\n      currentRoomForDemolish = '';\n    }\n  }\n\n  modal.classList.remove('hidden');\n}\n\nfunction closeRoomModal(targetDoc: Document): void {\n  const modal = targetDoc.getElementById('ngq-room-modal');\n  if (modal) {\n    modal.classList.add('hidden');\n    currentRoomForDemolish = '';\n  }\n}\n\n// æ‹†é™¤æˆ¿é—´\nfunction demolishRoom(targetDoc: Document): void {\n  if (!currentRoomForDemolish) return;\n\n  const confirmed = confirm(`ç¡®å®šè¦æ‹†é™¤ ${currentRoomForDemolish} å—ï¼Ÿ\\næ‹†é™¤åå°†å˜ä¸ºç©ºæˆ¿é—´ï¼Œéœ€è¦é‡æ–°è£…ä¿®æ‰èƒ½ä½¿ç”¨ã€‚`);\n\n  if (confirmed) {\n    const command = `æ‹†é™¤ ${currentRoomForDemolish}ï¼Œå°†å…¶è¿˜åŸä¸ºç©ºæˆ¿é—´çŠ¶æ€`;\n    fillCommand(command);\n    closeRoomModal(targetDoc);\n  }\n}\n\n// ==================== è£…ä¿®é€‰æ‹©æ¨¡æ€æ¡† ====================\nfunction openRenovateModal(targetDoc: Document, roomName: string): void {\n  console.log('ğŸ” openRenovateModal è¢«è°ƒç”¨ï¼Œä¼ å…¥çš„ roomName:', roomName, 'ç±»å‹:', typeof roomName);\n\n  const modal = targetDoc.getElementById('ngq-renovate-modal');\n  const info = targetDoc.getElementById('ngq-renovate-room-info');\n\n  if (!modal || !info) {\n    console.error('âŒ æ‰¾ä¸åˆ°è£…ä¿®æ¨¡æ€æ¡†å…ƒç´ ');\n    return;\n  }\n\n  currentRenovatingRoom = roomName;\n  console.log('âœ… å·²è®¾ç½® currentRenovatingRoom:', currentRenovatingRoom);\n  info.textContent = `é€‰æ‹©è¦å°† ${roomName} è£…ä¿®ä¸ºä½•ç§ç±»å‹ï¼š`;\n  modal.classList.remove('hidden');\n}\n\nfunction closeRenovateModal(targetDoc: Document, clearRoomName = true): void {\n  const modal = targetDoc.getElementById('ngq-renovate-modal');\n  if (modal) {\n    modal.classList.add('hidden');\n    // åªæœ‰åœ¨éœ€è¦æ—¶æ‰æ¸…ç©ºæˆ¿é—´å·ï¼ˆè£…ä¿®ä¸ºæ ‡å‡†å¥—é—´æ—¶æ¸…ç©ºï¼Œè½¬åˆ°åŠŸèƒ½æ€§æˆ¿é—´è¾“å…¥æ—¶ä¿ç•™ï¼‰\n    if (clearRoomName) {\n      currentRenovatingRoom = '';\n    }\n  }\n}\n\nfunction renovateToSuite(targetDoc: Document): void {\n  if (!currentRenovatingRoom) return;\n\n  const command = `å°† ${currentRenovatingRoom} è£…ä¿®ä¸ºæ ‡å‡†å¥—é—´ï¼ˆä¸€å®¤ä¸€å…ä¸€å«ä¸€å¨ï¼Œ35-50ã¡ï¼‰`;\n  fillCommand(command);\n  closeRenovateModal(targetDoc);\n}\n\nfunction renovateToFunctional(targetDoc: Document): void {\n  if (!currentRenovatingRoom) return;\n\n  // å…ˆæ‰“å¼€åŠŸèƒ½æ€§æˆ¿é—´è¾“å…¥æ¨¡æ€æ¡†ï¼Œå†å…³é—­è£…ä¿®é€‰æ‹©æ¨¡æ€æ¡†ï¼ˆä¸æ¸…ç©º currentRenovatingRoomï¼‰\n  openFunctionalInputModal(targetDoc);\n  closeRenovateModal(targetDoc, false); // ä¼ å…¥ false ä¿ç•™æˆ¿é—´å·\n}\n\n// ==================== åŠŸèƒ½æ€§æˆ¿é—´è¯¦æƒ…è¾“å…¥æ¨¡æ€æ¡† ====================\nfunction openFunctionalInputModal(targetDoc: Document): void {\n  console.log('ğŸ” openFunctionalInputModal è¢«è°ƒç”¨ï¼Œæˆ¿é—´å·:', currentRenovatingRoom);\n\n  const modal = targetDoc.getElementById('ngq-functional-input-modal');\n  const info = targetDoc.getElementById('ngq-functional-room-info');\n  const nameInput = targetDoc.getElementById('ngq-functional-name') as HTMLInputElement;\n  const purposeInput = targetDoc.getElementById('ngq-functional-purpose') as HTMLInputElement;\n\n  console.log('ğŸ” æ‰¾åˆ°çš„å…ƒç´ :', { modal, info, nameInput, purposeInput });\n\n  if (!modal || !info || !nameInput || !purposeInput) {\n    console.error('âŒ ç¼ºå°‘å¿…è¦å…ƒç´ ï¼Œæ— æ³•æ‰“å¼€æ¨¡æ€æ¡†');\n    return;\n  }\n\n  info.textContent = `è¯·è¾“å…¥ ${currentRenovatingRoom} çš„è¯¦ç»†ä¿¡æ¯ï¼š`;\n  nameInput.value = '';\n  purposeInput.value = '';\n  modal.classList.remove('hidden');\n  setTimeout(() => nameInput.focus(), 100);\n  console.log('âœ… åŠŸèƒ½æ€§æˆ¿é—´è¾“å…¥æ¨¡æ€æ¡†å·²æ‰“å¼€');\n}\n\nfunction closeFunctionalInputModal(targetDoc: Document): void {\n  const modal = targetDoc.getElementById('ngq-functional-input-modal');\n  if (modal) {\n    modal.classList.add('hidden');\n  }\n}\n\nfunction confirmFunctionalRenovate(targetDoc: Document): void {\n  console.log('ğŸ” confirmFunctionalRenovate è¢«è°ƒç”¨');\n  console.log('ğŸ” currentRenovatingRoom:', currentRenovatingRoom);\n\n  if (!currentRenovatingRoom) {\n    console.warn('âš ï¸ currentRenovatingRoom ä¸ºç©ºï¼Œé€€å‡º');\n    return;\n  }\n\n  const nameInput = targetDoc.getElementById('ngq-functional-name') as HTMLInputElement;\n  const purposeInput = targetDoc.getElementById('ngq-functional-purpose') as HTMLInputElement;\n\n  console.log('ğŸ” æ‰¾åˆ°çš„è¾“å…¥æ¡†:', { nameInput, purposeInput });\n\n  const name = nameInput?.value.trim() || '';\n  const purpose = purposeInput?.value.trim() || '';\n\n  console.log('ğŸ” è¾“å…¥å€¼:', { name, purpose });\n\n  if (!name) {\n    alert('è¯·è¾“å…¥æˆ¿é—´åç§°');\n    nameInput?.focus();\n    return;\n  }\n\n  if (!purpose) {\n    alert('è¯·è¾“å…¥æˆ¿é—´ä½œç”¨');\n    purposeInput?.focus();\n    return;\n  }\n\n  const command = `å°† ${currentRenovatingRoom} è£…ä¿®ä¸ºåŠŸèƒ½æ€§æˆ¿é—´ã€${name}ã€‘ï¼Œä½œç”¨ï¼š${purpose}`;\n  console.log('âœ… ç”Ÿæˆå‘½ä»¤:', command);\n  fillCommand(command);\n  closeFunctionalInputModal(targetDoc);\n  currentRenovatingRoom = '';\n}\n\nfunction initializeModalEvents(targetDoc: Document): void {\n  // ç¡®è®¤æŒ‰é’®\n  const confirmBtn = targetDoc.getElementById('ngq-modal-confirm');\n  if (confirmBtn) {\n    confirmBtn.addEventListener('click', () => {\n      confirmRecruitment(targetDoc);\n    });\n  }\n\n  // å–æ¶ˆæŒ‰é’®\n  const cancelBtn = targetDoc.getElementById('ngq-modal-cancel');\n  if (cancelBtn) {\n    cancelBtn.addEventListener('click', () => {\n      closeRecruitmentModal(targetDoc);\n    });\n  }\n\n  // ç‚¹å‡»èƒŒæ™¯å…³é—­\n  const modal = targetDoc.getElementById('ngq-recruitment-modal');\n  if (modal) {\n    modal.addEventListener('click', e => {\n      if (e.target === modal) {\n        closeRecruitmentModal(targetDoc);\n      }\n    });\n  }\n\n  // å›è½¦ç¡®è®¤\n  const input = targetDoc.getElementById('ngq-recruitment-keywords') as HTMLInputElement;\n  if (input) {\n    input.addEventListener('keypress', e => {\n      if (e.key === 'Enter') {\n        confirmRecruitment(targetDoc);\n      }\n    });\n  }\n\n  // æˆ¿é—´è¯¦æƒ…æ¨¡æ€æ¡†å…³é—­æŒ‰é’®\n  const roomCloseBtn = targetDoc.getElementById('ngq-room-modal-close');\n  if (roomCloseBtn) {\n    roomCloseBtn.addEventListener('click', () => {\n      closeRoomModal(targetDoc);\n    });\n  }\n\n  // æˆ¿é—´è¯¦æƒ…æ¨¡æ€æ¡†æ‹†é™¤æŒ‰é’®\n  const roomDemolishBtn = targetDoc.getElementById('ngq-room-demolish');\n  if (roomDemolishBtn) {\n    roomDemolishBtn.addEventListener('click', () => {\n      demolishRoom(targetDoc);\n    });\n  }\n\n  // ç‚¹å‡»èƒŒæ™¯å…³é—­æˆ¿é—´æ¨¡æ€æ¡†\n  const roomModal = targetDoc.getElementById('ngq-room-modal');\n  if (roomModal) {\n    roomModal.addEventListener('click', e => {\n      if (e.target === roomModal) {\n        closeRoomModal(targetDoc);\n      }\n    });\n  }\n\n  // è£…ä¿®æ¨¡æ€æ¡† - è£…ä¿®ä¸ºæ ‡å‡†å¥—é—´\n  const renovateSuiteBtn = targetDoc.getElementById('ngq-renovate-suite');\n  if (renovateSuiteBtn) {\n    renovateSuiteBtn.addEventListener('click', () => {\n      renovateToSuite(targetDoc);\n    });\n  }\n\n  // è£…ä¿®æ¨¡æ€æ¡† - è£…ä¿®ä¸ºåŠŸèƒ½æ€§æˆ¿é—´\n  const renovateFunctionalBtn = targetDoc.getElementById('ngq-renovate-functional');\n  if (renovateFunctionalBtn) {\n    renovateFunctionalBtn.addEventListener('click', () => {\n      renovateToFunctional(targetDoc);\n    });\n  }\n\n  // è£…ä¿®æ¨¡æ€æ¡† - å–æ¶ˆæŒ‰é’®\n  const renovateCancelBtn = targetDoc.getElementById('ngq-renovate-cancel');\n  if (renovateCancelBtn) {\n    renovateCancelBtn.addEventListener('click', () => {\n      closeRenovateModal(targetDoc);\n    });\n  }\n\n  // ç‚¹å‡»èƒŒæ™¯å…³é—­è£…ä¿®æ¨¡æ€æ¡†\n  const renovateModal = targetDoc.getElementById('ngq-renovate-modal');\n  if (renovateModal) {\n    renovateModal.addEventListener('click', e => {\n      if (e.target === renovateModal) {\n        closeRenovateModal(targetDoc);\n      }\n    });\n  }\n\n  // åŠŸèƒ½æ€§æˆ¿é—´è¾“å…¥æ¨¡æ€æ¡† - ç¡®è®¤æŒ‰é’®\n  const functionalConfirmBtn = targetDoc.getElementById('ngq-functional-confirm');\n  console.log('ğŸ” åŠŸèƒ½æ€§æˆ¿é—´ç¡®è®¤æŒ‰é’®:', functionalConfirmBtn);\n  if (functionalConfirmBtn) {\n    functionalConfirmBtn.addEventListener('click', () => {\n      console.log('ğŸ–±ï¸ åŠŸèƒ½æ€§æˆ¿é—´ç¡®è®¤æŒ‰é’®è¢«ç‚¹å‡»');\n      confirmFunctionalRenovate(targetDoc);\n    });\n  } else {\n    console.error('âŒ æœªæ‰¾åˆ°åŠŸèƒ½æ€§æˆ¿é—´ç¡®è®¤æŒ‰é’® (ngq-functional-confirm)');\n  }\n\n  // åŠŸèƒ½æ€§æˆ¿é—´è¾“å…¥æ¨¡æ€æ¡† - å–æ¶ˆæŒ‰é’®\n  const functionalCancelBtn = targetDoc.getElementById('ngq-functional-cancel');\n  if (functionalCancelBtn) {\n    functionalCancelBtn.addEventListener('click', () => {\n      closeFunctionalInputModal(targetDoc);\n      currentRenovatingRoom = '';\n    });\n  }\n\n  // ç‚¹å‡»èƒŒæ™¯å…³é—­åŠŸèƒ½æ€§æˆ¿é—´è¾“å…¥æ¨¡æ€æ¡†\n  const functionalModal = targetDoc.getElementById('ngq-functional-input-modal');\n  if (functionalModal) {\n    functionalModal.addEventListener('click', e => {\n      if (e.target === functionalModal) {\n        closeFunctionalInputModal(targetDoc);\n        currentRenovatingRoom = '';\n      }\n    });\n  }\n\n  // åŠŸèƒ½æ€§æˆ¿é—´è¾“å…¥æ¨¡æ€æ¡† - å›è½¦ç¡®è®¤\n  const functionalNameInput = targetDoc.getElementById('ngq-functional-name') as HTMLInputElement;\n  const functionalPurposeInput = targetDoc.getElementById('ngq-functional-purpose') as HTMLInputElement;\n  if (functionalNameInput && functionalPurposeInput) {\n    [functionalNameInput, functionalPurposeInput].forEach(input => {\n      input.addEventListener('keypress', e => {\n        if (e.key === 'Enter') {\n          confirmFunctionalRenovate(targetDoc);\n        }\n      });\n    });\n  }\n\n  console.log('âœ… æ¨¡æ€æ¡†äº‹ä»¶å·²åˆå§‹åŒ–');\n}\n\n// å¡«å……å‘½ä»¤åˆ°è¾“å…¥æ¡†\nfunction fillCommand(command: string): void {\n  try {\n    const chatInput = (parent.document || document).querySelector('#send_textarea') as HTMLTextAreaElement;\n    if (chatInput) {\n      if (chatInput.value.trim() !== '') {\n        chatInput.value += '\\n\\n' + command;\n      } else {\n        chatInput.value = command;\n      }\n      chatInput.focus();\n      console.log('âœ… å‘½ä»¤å·²å¡«å……åˆ°è¾“å…¥æ¡†');\n    } else {\n      throw new Error('æœªæ‰¾åˆ°è¾“å…¥æ¡†');\n    }\n  } catch (e) {\n    alert('æœªèƒ½è‡ªåŠ¨æ‰¾åˆ°è¾“å…¥æ¡†ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶å‘½ä»¤ï¼š\\n\\n' + command);\n    console.error('å¡«å……å‘½ä»¤å¤±è´¥:', e);\n  }\n}\n\n// ==================== å¯åŠ¨è„šæœ¬ ====================\nfunction waitForJQuery(callback: () => void): void {\n  if (typeof jQuery !== 'undefined' || typeof $ !== 'undefined') {\n    console.log('âœ… jQuery å·²å°±ç»ª');\n    callback();\n  } else {\n    console.log('â³ ç­‰å¾… jQuery...');\n    setTimeout(() => waitForJQuery(callback), 100);\n  }\n}\n\n// ä½¿ç”¨ jQuery çš„æ–¹å¼åˆå§‹åŒ–\nwaitForJQuery(() => {\n  $(() => {\n    console.log('âœ… å¼€å§‹åˆå§‹åŒ–ç½‘çº¢å°åŒºæ’ä»¶');\n    initializeNgqPlugin();\n  });\n});\n\nconsole.log('âœ… ç½‘çº¢å°åŒºæ’ä»¶è„šæœ¬åŠ è½½å®Œæˆ');\n\n// å¯¼å‡ºä¸€ä¸ªå€¼ä»¥ä½¿å…¶æˆä¸ºåˆæ³•çš„ES Module\nexport const __initialized__ = true;\n"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","console","log","btnDragData","panelDragData","cachedMVUData","currentRetry","autoRefreshTimer","contentEventsInitialized","currentRenovatingRoom","currentRoomForDemolish","safeGetValue","path","defaultValue","keys","split","current","Array","isArray","length","String","initializeNgqPlugin","targetDoc","window","top","document","e","warn","getElementById","remove","$","off","head","insertAdjacentHTML","body","btn","saved","localStorage","getItem","pos","JSON","parse","targetWindow","maxX","width","maxY","height","left","style","panel","$targetDoc","handleBtnDragStart","clientX","clientY","computedStyle","getComputedStyle","currentLeft","parseInt","currentTop","startX","startY","initialLeft","initialTop","classList","add","handleBtnDragMove","deltaX","deltaY","newLeft","newTop","Math","max","min","handleBtnDragEnd","distance","sqrt","position","setItem","stringify","toggle","contains","loadNgqData","on","preventDefault","stopPropagation","touch","originalEvent","touches","changedTouches","initializeButtonDrag","closeBtn","addEventListener","header","error","handlePanelDragStart","rect","getBoundingClientRect","setProperty","addClass","handlePanelDragMove","handlePanelDragEnd","savedPosition","removeClass","target","closest","savedPos","initializePanelDrag","initializePanelSystem","confirmBtn","confirmRecruitment","cancelBtn","closeRecruitmentModal","modal","input","roomCloseBtn","closeRoomModal","roomDemolishBtn","confirm","fillCommand","demolishRoom","roomModal","renovateSuiteBtn","closeRenovateModal","renovateToSuite","renovateFunctionalBtn","info","nameInput","purposeInput","textContent","value","setTimeout","focus","openFunctionalInputModal","renovateToFunctional","renovateCancelBtn","renovateModal","functionalConfirmBtn","confirmFunctionalRenovate","functionalCancelBtn","closeFunctionalInputModal","functionalModal","functionalNameInput","functionalPurposeInput","forEach","initializeModalEvents","async","Mvu","parent","Error","showError","mvuResult","getMvuData","type","message_id","data","stat_data","contentDiv","timeDisplay","date","trim","time","location","html","cfg","rooms","floors","filter","k","map","order","parseFloat","name","capacity","sort","a","b","floor","floorRooms","roomKeys","roomKey","r","layout","tenant","push","getOrder","includes","orderDiff","localeCompare","mergedRooms","skipIndices","Set","i","has","currentRoom","nextRoom","isMerged","roomGroup","isYourRoom","isEmptyRoom","isSuite","isPublicLounge","isPublicGym","isPublicLaundry","isDefaultPublic","isCustomFunctional","isVacant","cls","tenantDisplay","roomIcon","roomName","typeLabel","renderSingleFloor","renderOverviewPage","innerHTML","content","roomCard","getAttribute","roomType","roomTenant","outerHTML","substring","openRenovateModal","tenantName","title","roomData","isPublic","desc","tenantData","age","job","creatorType","appearance","personality","favorValue","lustValue","days","funcArea","facilityColor","facilityIcon","demolishActionsDiv","display","openRoomModal","matches","action","openRecruitmentModal","clearInterval","setInterval","initializeContentEvents","renderNgqData","message","keywords","alert","clearRoomName","purpose","command","chatInput","querySelector","waitForJQuery","callback","jQuery","__initialized__"],"ignoreList":[],"sourceRoot":""}