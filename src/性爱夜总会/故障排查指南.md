# 🔧 江畔夜总会插件 - 故障排查指南

## 问题：悬浮按钮不出现

按照以下步骤逐一排查：

---

## 第一步：确认酒馆助手插件已安装并启用

1. 打开 SillyTavern
2. 点击顶部的 **Extensions（扩展）** 按钮（通常是一个拼图图标）
3. 在扩展列表中找到 **Tavern Helper（酒馆助手）**
4. 确认开关是 **ON（开启）** 状态

**如果找不到酒馆助手：**

- 你需要先安装此插件
- 可能需要从 SillyTavern 的插件市场下载

---

## 第二步：确认脚本已正确导入

### 方法 A：通过酒馆助手界面导入

1. 点击酒馆助手的设置图标
2. 找到 **Scripts（脚本）** 部分
3. 点击 **Import Script（导入脚本）** 或 **+** 按钮
4. 选择 `江畔夜总会-悬浮状态栏.json` 文件
5. 确认导入成功

### 方法 B：手动复制文件

1. 找到 SillyTavern 的数据目录：

   ```
   [SillyTavern安装目录]/data/default-user/scripts/
   ```

2. 将 `江畔夜总会-悬浮状态栏.json` 复制到此目录
3. 重启 SillyTavern 或刷新页面

---

## 第三步：检查脚本是否启用

1. 在酒馆助手的脚本列表中找到 **"江畔夜总会-悬浮状态栏"**
2. 确认脚本前面的开关是 **ON（启用）** 状态
3. 如果是 OFF，点击开关启用它

---

## 第四步：检查浏览器控制台

1. 按 **F12** 打开开发者工具
2. 切换到 **Console（控制台）** 标签
3. **刷新页面**
4. 查看是否有以下日志：

### ✅ 正常情况应该看到

```
🌙 加载江畔夜总会管理面板插件...
✨ 江畔夜总会插件脚本加载完成
🏗️ 初始化江畔夜总会插件...
✅ 江畔夜总会插件初始化完成
```

### ❌ 如果看到错误

- 记录完整的错误信息
- 截图控制台内容

---

## 第五步：尝试手动加载（测试用）

如果通过酒馆助手无法加载，可以手动测试脚本是否正常：

1. 按 **F12** 打开控制台
2. 打开 `状态栏插件.js` 文件
3. **复制所有代码**
4. **粘贴到控制台** 并按 **Enter**
5. 如果脚本代码没问题，悬浮按钮应该立即出现

**如果手动加载成功：**
→ 说明代码本身没问题，问题出在酒馆助手的加载机制

**如果手动加载也失败：**
→ 说明代码本身有问题，查看控制台错误信息

---

## 第六步：运行诊断脚本

使用我们提供的诊断脚本快速检查环境：

1. 打开 `快速诊断.js` 文件
2. **复制所有代码**
3. 按 **F12** 打开浏览器控制台
4. **粘贴代码并按 Enter**
5. 查看诊断结果

诊断脚本会自动检查：

- jQuery 是否加载
- MVU 框架是否可用
- 插件元素是否存在
- 样式是否加载
- 可能的问题原因

---

## 第七步：检查 JSON 文件格式

确保 JSON 文件格式正确，可以使用在线工具验证：

- <https://jsonlint.com/>
- 将 `江畔夜总会-悬浮状态栏.json` 内容粘贴进去验证

---

## 🆘 如果以上方法都不行

### 终极解决方案：直接手动注入脚本

如果酒馆助手始终无法加载，可以使用浏览器扩展自动注入：

#### 方法 1：使用 Tampermonkey（推荐）

1. 安装 **Tampermonkey** 浏览器扩展
2. 创建新脚本
3. 将 `状态栏插件.js` 的内容复制进去
4. 设置匹配 SillyTavern 的 URL
5. 保存并启用

示例脚本头：

```javascript
// ==UserScript==
// @name         江畔夜总会状态栏
// @namespace    http://tampermonkey.net/
// @version      1.0
// @description  SillyTavern 江畔夜总会管理面板
// @match        http://localhost:8000/*
// @match        http://127.0.0.1:8000/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';
    
    // 在这里粘贴 状态栏插件.js 的完整代码
})();
```

#### 方法 2：使用浏览器书签

1. 创建新书签
2. 书签地址设置为：

   ```javascript
   javascript:(function(){/* 粘贴压缩后的插件代码 */})();
   ```

3. 每次需要时点击书签加载

---

## 📞 获取更多帮助

如果问题仍未解决，请提供以下信息：

1. **浏览器控制台的完整错误信息**（截图）
2. **诊断脚本的输出结果**（截图）
3. **SillyTavern 版本**
4. **酒馆助手插件版本**（如果有）
5. **操作系统**

---

## ✅ 成功标志

插件成功加载后，你应该看到：

1. **右下角出现 🌙 月亮图标的悬浮按钮**
2. **按钮可以拖动**
3. **点击按钮打开管理面板**
4. **控制台显示成功日志**：

   ```
   🌙 加载江畔夜总会管理面板插件...
   ✨ 江畔夜总会插件脚本加载完成
   🏗️ 初始化江畔夜总会插件...
   ✅ 江畔夜总会插件初始化完成
   ```

<function_calls>
<invoke name="run_terminal_cmd">
<parameter name="command">cd nova-creator-cli/作品/性爱夜总会 && python -m json.tool 江畔夜总会-悬浮状态栏.json > nul 2>&1 && echo JSON格式正确 || echo JSON格式错误
